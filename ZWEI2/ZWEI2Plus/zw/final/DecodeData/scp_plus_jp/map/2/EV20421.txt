//====================================================================
//ステージトラップスクリプト
//[12042][水没神殿－サブ②]
//====================================================================

#ScriptTable

#BOSS 		1

//--------------------------------------------------------------------
//■グローバルフラグ・ルートフラグはev20411.txt参照

//■ローカルフラグ
// 100 イベント進行エリア1到達
// 101 イベント進行エリア2到達
// 102 イベント進行エリア3到達
// 103 中ボスBGM管理
// 104 中ボス警報
// 105 中ボス戦開始
// 106 ②フットスイッチを踏んだ
// 107 ②フットスイッチロック

#TREASURE_CH	49
#Fx_TREASURE	2302	//☆002マンモス

//--------------------------------------------------------------------
INIT
{
//環境SE
	SE(71,0)

//■地形
	//床飾りマーク
	set_obj("mo20021a",	 2, 5,     0,-900,  1,  270)
	set_obj("mo20021a",	 2, 5,     0, 900,  1,  270)

	//天井から光
    set_obj("mo20031a",	 1, 5,   150,   0,  0,    0)
   set_obj("mo20031a",	 7, 5,     0,   0,  0,    0)

//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
//■階段・扉

	set_chr( 90,990,	10, 5,  -100,   0,  0,		 90,  0102, 6,"K0_1;")		//①エントリ サブ①
	set_obj("@ob20111a",10, 5,     0,   0,  0,		 90)						//①階段下（神殿）
	set_chr(190,1300,	10, 5,     0,   0,  0,		  0,    90, 0,";")			//階段下（ダミー）
	// 出口エントリは後ろのほうに移動

	set_chr( 50,507,	 9, 5,  -900,   0,  0,		  7,   270, 8,"F1 WT?45 M7?99 M4_99;")	//③扉（神殿） 閉鎖
	set_chr( 51,507,	 6, 5,  -900,   0,  0,		  7,   270, 8,"F1 WT?30 M7?99 M4_99;")	//④扉（神殿） 閉鎖
	set_chr( 52,507,	 4, 5,  -900,   0,  0,		  7,   270, 8,"F1 WT?15 M7?99 M4_99;")	//⑤扉（神殿） 閉鎖
	set_chr( 53,507,	 2, 6,     0, 900,  0,		  7,   180, 0,";")	//⑥扉（神殿） 閉鎖

//■スイッチ・看板
	set_chr( 54,658,	 4, 5,  -350,-350,  0,		  0,   270, 0,";")			//①中ボス看板
//	set_chr( 59,649,	 1, 5,   450,   0,  0,		  2,   270, 0,"") //②フットスイッチ
	set_chr( 59,649,	 2, 6,     0,-900,  0,		  2,   180, 0,"") //②フットスイッチ
	set_chr( 58,649,	 2, 8,     0,   0,  0,		  7,   270, 0,"") //③フットスイッチ

//■ハニワ・壷

	if ( !F2160 )
	{
		set_chr( 40,802,	 8, 5,     0,-400,  0,		  2,    90, 0,"I_$$$1 SF2160 V4_140;")	//①壷
		set_chr(140,811,	 8, 5,     0,-400,  0,		 -1,    90, 0,";")
	}
	else
	{
		set_chr(140,811,	 8, 5,     0,-400,  0,		  0,    90, 0,";")
	}


	if ( !F2161 )
	{
		set_chr( 41,802,	 6, 5,     0,-400,  0,		  2,   270, 0,"I_$$$1 SF2161 V4_141;")	//②壷
		set_chr(141,811,	 6, 5,     0,-400,  0,		 -1,   270, 0,";")
	}
	else
	{
		set_chr(141,811,	 6, 5,     0,-400,  0,		  0,   270, 0,";")
	}


	if ( !F2162 )
	{
		set_chr( 42,802,	 5, 5,     0, 400,  0,		  2,     0, 0,"I_$$$1 SF2162 V4_142;")	//③壷
		set_chr(142,811,	 5, 5,     0, 400,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(142,811,	 5, 5,     0, 400,  0,		  0,     0, 0,";")
	}


	if ( !F2163 )
	{
		set_chr( 43,634,	 1, 5,  -225,   0,  0,		  2,   270, 0,"I_US01 SF2163 V4_143;")	//④ハニワ
		set_chr(143,812,	 1, 5,  -225,   0,  0,		 -1,   270, 0,";")
	}
	else
	{
		set_chr(143,812,	 1, 5,  -225,   0,  0,		  0,   270, 0,";")
	}

//■宝箱
	if( !Fx_TREASURE )
	{
		set_chr( TREASURE_CH,561,	 2, 8,     0,   0,  0,     6,   180,20,"<TK_TREASURE><EV_FootSwitchUP>;")
		set_chr(167,990,	 2, 6,  -600,-450,  0,		  0,     0, 8,"F106 O1_18 WT?10 C0_53 WT?20 M4_53 WT?30 C0_0 WT?31 (!F106 M5_53 WT?15 F106 M4_53 WT?15 );")//扉
	}
	else
	{
		set_chr( TREASURE_CH,561,	 2, 8,     0,   0,  0,     7,   180, 0,";")

		MOT( 53, 6, 1 ) 
		MOT( 58, 4, 0 )
		MOT( 59, 7, 0)
		F_set(107);
	}
	chr_equip_chr( 49,	58,"body", 100,	  0,0,270,		0,0,25);


	set_chr(168,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"F107 SF106")//①フットスイッチ
	set_chr(169,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"RF106 !F107 M2!59 SF106")//①フットスイッチ
	set_chr(170,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F107 L4?5901 M3!59 M3_59")
	set_chr(171,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F107 L2?5902 M3!59 M3_59")
	set_chr(172,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F107 L2?5903 M3!59 M3_59")
	set_chr(173,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F107 L2?5904 M3!59 M3_59")
	set_chr(174,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F107 L2?5905 M3!59 M3_59")
	set_chr(175,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F107 L3?5997 M3!59 M3_59")

//■罠・障害物

//■敵
	if ( !F2100 )
	{
		set_chr(BOSS,355,	 9, 5,  -250,   0,  0,		  0,   270, 0,"I_FFF3 I_FFF3 I_FFF3;")	//①敵 がにめーでー
			MOT(BOSS, 3, 0)		// 静止
			rot(BOSS,180,90)	// 90度を向く
			color(BOSS,-1)		// 透明に
			F_set_chr(BOSS,		CF_NO_MINIMAP)	// ボス ミニマップ非表示

		// 逃走中と倒した後はエントリに入れる。ボスが攻撃モードに移っている間は反応しない
		set_chr( 91,990,	 9, 5,     0,   0,  0,		270,030102, 6,"K0_0;")	//②エントリ サブ③
		set_chr( 97,1321,	 9, 5,     0,   0,  0,		  0,   270, 0,";")		//②階段上（神殿）
		set_chr( 96,675,	 9, 5,     0,   0,  0,		  2,   270, 8,"F1 D0_99;")	//②球石
			color2( 96, 100,73,100,  0,0, 0)	// ボスの腹？
			F_set_chr( 96, CF_NO_MINIMAP)	// 球石 ミニマップ非表示
			F_set_chr( 96, CF_NO_HPBAR)	// 球石 HPバー無し
			F_set_chr( 96, CF_NO_DAMAGE_C)
			F_set_chr( 96, CF_NO_CSP)

		chr_equip_chr( 91,	BOSS,"Bone_Hips", 100,	0,0,0,		0,-250,175);
		chr_equip_chr( 97,	BOSS,"Bone_Hips", 100,	0,0,0,		0,-300,20);
		chr_equip_chr( 96,	BOSS,"Bone_Hips",  45,	0,0,180,	0,-120, 0);
	}
	else
	{
		set_chr( 91,990,	 9, 5,     0,   0,  0,		270,030102, 6,"K0_0;")	//②エントリ サブ③
		set_chr( 97,1321,	 9, 5,     0,   0,  0,		  0,   270, 0,";")		//②階段上（神殿）
		MOT( 50, 6, 1)	// ③扉
		MOT( 51, 6, 1)	// ④扉
		MOT( 52, 6, 1)	// ⑤扉
	}

	set_chr(  2,127,	 7, 5,     0, 400,  0,		  0,   270, 0,";")	//②敵 がにめで
	set_chr(  3,127,	 4, 5,     0,-400,  0,		  0,   270, 0,";")	//③敵 がにめで
	set_chr(  4,127,	 2, 4,     0,-150,  0,		  0,     0, 0,";")	//④敵 がにめで
	set_chr(  5,127,	 2, 6,     0, 150,  0,		  0,   180, 0,";")	//⑤敵 がにめで



//■イベント
//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
	if ( !F2100 )
	{
		set_chr( 80,990,	 9, 5,   450,   0,  0,		  0,  0505, 6,"SF100;")// 中ボスエリア1
		set_chr( 81,990,	 6, 5,   450,   0,  0,		  0,  0505, 6,"SF101;")// 中ボスエリア2
		set_chr( 82,990,	 3, 5,   450,   0,  0,		  0,  0505, 6,"SF102;")// 中ボスエリア3
		set_chr( 83,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F100 <EV_BossRunAway1>;")// 中ボス進行1
		set_chr( 84,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F101 <EV_BossRunAway2>;")// 中ボス進行2
		set_chr( 85,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F102 <EV_BossRunAway3> !F1 F105 #3_91;")// 中ボス進行3

		set_chr( 86,990,	 4, 5,  -100,   0,  0,		  0,  0111, 6,"SF104;")//奥の部屋 戦闘開始エリア 
		set_chr( 87,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F104 !F1 S0_1 WT?120;")//警報出現

		set_chr( 88,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F1 WT?10 SF2100 <EV_NormalBGM> <EV_BossFinish> RF104 WT?20 #6_91;")//中ボス戦闘終了

		// 中ボスBGM
		set_chr(160,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"(F103 <EV_BossBGM> WT?90 !F104 !F103 <EV_NormalBGM> WT?90);");
		set_chr(161,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F2100 F104 SF103");	// ボスが生きていて、ボス戦闘中ならば103をセット
		set_chr(163,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"RF103");				// 103をクリア
	}

//■場面固有設定
	map_color(100,100,100,0);//R,G,B, time 100%
	map_spotbmp(25);//100%
}

//--------------------------------------------------------------------
EV_BossRunAway1
{
	F_reset_chr(BOSS,	CF_NO_MINIMAP)	// ボス ミニマップ表示
	color(BOSS,30)		// 不透明に

	MOT(BOSS, 4, 15)	// イベント用待機
	wait(10)

	MOT(BOSS, 1, 15)	// 走り
	move(BOSS, 0, 35, 10950,9450,0, 50)	// 11250,9450
	MOT(50, 4, 0)		// 扉開く
	wait(30)

	wait_move(BOSS)
	MOT(BOSS, 4, 15)	// イベント用待機
}

//--------------------------------------------------------------------
EV_BossRunAway2
{
	MOT(BOSS, 1, 15)	// 走り
	wait(10)
	move(BOSS, 0, 40, 7350,9450,0, 50)	// 7650,9450
	MOT(51, 4, 0)		// 扉開く
	wait(10)
	wait_move(BOSS)
	MOT(BOSS, 4, 15)	// イベント用待機

	MOT(BOSS, 1, 15)	// 走り
	wait(10)
	move(BOSS, 0, 40, 5350,9450,0, 50)	// 5650,9450
	MOT(52, 4, 0)		// 扉開く
	wait(10)
	wait_move(BOSS)
	MOT(BOSS, 4, 15)	// イベント用待機
}

//--------------------------------------------------------------------
EV_BossRunAway3
{
	MOT(BOSS, 1, 15)	// 走り
	wait(10)
	move(BOSS, 0, 40, 3800,9450,0, 50)	// 4050,9450
	MOT(52, 4, 0)		// 扉開く
	wait(10)
	wait_move(BOSS)
	MOT(BOSS, 30, 15)	// 攻撃前兆
	F_set(105)			// ボス戦開始
}

//--------------------------------------------------------------------
EV_BossFinish
{
	// 階段落下
	jump(91,3, 24,-1,-1,0,150)
	jump(97,3, 24,-1,-1,0,150)
}

//--------------------------------------------------------------------
EV_BossBGM
{
	stop_BGM(30)
	wait(30)
	BGM(35)
}

//--------------------------------------------------------------------
EV_NormalBGM
{
	stop_BGM(30)
	wait(30)
	BGM(22)
}

//--------------------------------------------------------------------
EV_FootSwitchUP
{
	wait_EV("TK_TREASURE")	

	wait( 10 )
	MOT( 58, 5, 0 )

	wait( 10 )
	MOT( 53, 6, 1 )
	MOT( 59, 7, 1 )
	F_set(107)
}

#EndScriptTable
//====================================================================

