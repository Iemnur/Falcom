//====================================================================
//ステージトラップスクリプト
//[14042][大鉄塔－サブ②]
//====================================================================

#ScriptTable

//--------------------------------------------------------------------
//■グローバルフラグ・ルートフラグはev40410.txt参照

//■ローカルフラグ
// 100 中ボス警報
// 101 中ボス出現
// 102 中ボス取り巻きザコが出現
// 103 中ボスBGM管理
//x 106 ボス部屋内週
// 107 ワープ許可
// 108 ワープした

#TREASURE_CH	49
#Fx_TREASURE	2303	//☆003ロケット

//--------------------------------------------------------------------
INIT
{
//環境SE
	SE(63,0)
	SE(65,0)

//■地形
	set_obj2("mp40140",	 4, 4,  -450,   0,  0,   0) //
	set_obj2("mp40150",	 4, 4,   450,   0,  0,   0) //
	set_obj2("obx001k",	 4, 4,     0, 450,  0,	  180) //鉄塔縁↓
	set_obj2("obx001k",	 4, 4,     0,-450,  0,	    0) //鉄塔縁↑

	set_chr(193,991,	 4, 4,     0, 950,  0,	 0,071401, 0,";")	// 空気壁
	set_chr(194,991,	 4, 4,     0,-950,  0,	 0,071401, 0,";")	// 空気壁

//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
//■階段・扉
	set_chr( 90,990,	 6, 6,     0,   0,  0,		 90,  0102, 6,"K0_1;")		//①エントリ サブ①
	set_obj("@ob40010a", 6, 6,     0,   0,  0,		 90) 						//①階段下（塔）
	set_chr(190,1300,	 6, 6,	   0,   0,  0,		  0,    90, 0,";")			//階段下（ダミー）

	set_chr( 91,990,	 7, 4,     0, 900,  0,		180,  0201, 6,"K0_0;")		//②エントリ サブ③
	set_obj("@ob40000a", 7, 4,     0, 900,  0,		180) 						//②階段上（塔）
	set_chr(191,1301,	 7, 4,	   0, 900,  0,		  0,   180, 0,";")			//階段上（ダミー）

	set_chr( 93,990,	 4, 4,     0,-100,  0,		  0,  0201, 6,"K4_3")	//⑧エントリ 
	set_obj("@ob40030a", 4, 4,     0,-200,  1,		  0) 					//⑧塔土管(サブワープ）

	set_chr( 94,990,	 6, 5,     0, 100,  0,		180,  0201, 6,"K3_3")	//⑨エントリ 
	set_obj("@ob40030a", 6, 5,     0, 200,  1,		180) 					//⑨塔土管(サブワープ）

	set_chr( 96,668,	 6, 5,     0,-700,  0,		  0,     0, 8,"F108 <EV_WarpGateVanish> WT?15;")	//⑤ワープ魔法陣

	// チェックポイント
	set_chr( 95,990,	 4, 4,     0, 450,  0,		180,070401, 6,"k5_0")

	// 扉
	set_chr( 50,500,	 4, 5,     0, 450,  0,		  3,     0, 6,"M4_99 #3_99;")	//③扉（塔）閉鎖→開放
	set_chr( 51,500,	 5, 3,   450,   0,  0,		  3,   270, 6,"M4_99 #3_99;")	//④扉（塔）閉鎖→開放
	set_chr( 52,500,	 6, 5,     0,-900,  0,		  8,     0, 6,";")	//⑤扉（塔）


//■スイッチ・看板
	set_chr( 60,658,	 4, 6,  -300,-475,  0,		  0,     0, 0,";")	//②中ボス看板
	set_chr( 61,804,	 4, 6,  -300,-475,115,		  0,     0, 8,"(L2?99 [9991ﾉ櫤wｺﾋﾈﾚｺﾏ\n訣t] WT?30 L2!99 [9903] WT?30);")	//①看板-

	set_chr( 62,655,	 4, 5,     0,-650, 50,        2,     0, 0,";")	//③順路案内
	set_chr( 63,655,	 5, 3,  -150,-250, 50,        2,     0, 0,";")	//④順路案内

	set_chr( 64,571,	 4, 5,  -245,-650, 50,  	  7,     0,	5,"M!_99 M!_65")	//⑤レバースイッチ
	set_chr( 65,571,	 5, 3,  -700,-245, 50,  	  7,     0,	5,"M!_99 M!_64")	//⑥レバースイッチ

//■ハニワ・壷


	if ( !F2160 )
	{
		set_chr( 40,634,	 3, 6,     0,   0,  0,		  2,     0, 0,"I_US01 SF2160 V4_140;")	//①ハニワ
		set_chr(140,812,	 3, 6,     0,   0,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(140,812,	 3, 6,     0,   0,  0,		  0,     0, 0,";")
	}


	if ( !F2161 )
	{
		set_chr( 41,802,	 3, 3,    50,  50,  0,		  2,     0, 0,"I_$$$1 SF2161 V4_141;")	//②壷
		set_chr(141,811,	 3, 3,    50,  50,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(141,811,	 3, 3,    50,  50,  0,		  0,     0, 0,";")
	}


	if ( !F2162 )
	{
		set_chr( 42,802,	 7, 5,     0,   0,  0,		  2,     0, 0,"I_$$$1 SF2162 V4_142;")	//③壷
		set_chr(142,811,	 7, 5,     0,   0,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(142,811,	 7, 5,     0,   0,  0,		  0,     0, 0,";")
	}


//■宝箱
	if( !Fx_TREASURE )
		set_chr( TREASURE_CH,561,	 4, 4,     0, 500,  0,     6,   180,20,"<TK_TREASURE>;")
	else
		set_chr( TREASURE_CH,561,	 4, 4,     0, 500,  0,     7,   180, 0,";")

//■罠・障害物

	set_chr(117 627,	 6, 5,   900,   0,  0,		  0,    90, 0,";")	//柵小
	color2(117, 100,85,85, 0,0,0)	// 塔の柵の色

	if ( !F2185 )
	{
		set_chr( 69 641,	 6, 4,   100,   0,  0,		  4,     0, 0,"I_$$$2 SF2185;")	//①パラボラアンテナ
	}

//■敵
//■イベント

	if ( !F2100 )
	{
		set_chr(  1,362,	 5, 4,  -150,   0,  0,		 -1,     0, 8,"F101 WT?55 V2_99;") //①敵a おおひのとり
		set_chr(  2,225,	 3, 5,   150,-150,  0,		 -1,    90, 8,"F101 WT?5  V2_99;") //①敵b ひのとり
		set_chr(  3,225,	 5, 5,  -150,-150,  0,		 -1,   180, 8,"F101 WT?15 V2_99;") //①敵c ひのとり
		set_chr(  4,225,	 3, 3,   150, 150,  0,		 -1,   270, 8,"F101 WT?25 V2_99;") //①敵d ひのとり
		set_chr(  5,225,	 5, 3,  -150, 150,  0,		 -1,     0, 8,"F101 WT?35 V2_99;") //①敵e ひのとり
		set_chr(  6,225,	 3, 4,   150,   0,  0,		 -1,   180, 8,"F101 WT?45 V2_99;") //①敵f ひのとり

		F_set_chr( 1,CF_NO_CLIP2)
		F_set_chr( 2,CF_NO_CLIP2)
		F_set_chr( 3,CF_NO_CLIP2)
		F_set_chr( 4,CF_NO_CLIP2)
		F_set_chr( 5,CF_NO_CLIP2)
		F_set_chr( 6,CF_NO_CLIP2)

		set_chr( 81,990,	 5, 3,   100,   0,  0,		  0,   106, 6,"SF100;")//①敵 中ボス部屋 戦闘開始エリアa
		set_chr( 82,990,	 4, 5,     0, 100,  0,		  0,   601, 6,"SF100;")//①敵 中ボス部屋 戦闘開始エリアb
		set_chr( 83,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F100 S0_1 WT?120 #6_84;")//警報出現
		set_chr( 84,990,	 4, 4,     0,   0,  0,		  0,074040, 0,"SF101 M5_50 M5_51 #3_50 #3_51 V2_1 <EV_BossActivate1>;")//中ボス出現
		if(WK_ENTRY==91)//階段91 から来た時（帰り）
		{
			set_chr( 85,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F1 WT?10 O1_18 SF2100 <EV_NormalBGM> WT?30 C0_50 WT?20 M4_51 M4_50 WT?30 C0_0 WT?20 SF107;")//中ボス戦闘終了
		}
		else
		{
			set_chr( 85,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F1 WT?10 O1_18 SF2100 <EV_NormalBGM> WT?30 C0_51 WT?20 M4_51 M4_50 WT?30 C0_0 SF107;")//中ボス戦闘終了
		}

		// 中ボスBGM
		set_chr(160,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"(F103 <EV_BossBGM> WT?90 !F101 !F103 <EV_NormalBGM> WT?90);");
		set_chr(161,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F2100 F101 SF103");
		set_chr(162,990,	 4, 4,     0,   0,  0,		  0,074040, 6,"!F2100 SF103");
		set_chr(163,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"RF103");

		set_chr(150,990, 	0, 0,     0,   0,  0,     0,     0, 8,"F101 F1 <EV_BossFinish1> WT?10 <EV_BossBoxFall1> WT?25;")	// 進行管理
	}
	else
	{
		F_set(107)
		set_chr( 92,668,	 5, 4,  -150,   0,  0,		  0,      0, 8," F107 (L1?9900 <EV_Warp_X> WT?15 K6_3 SF108 WT?60);")	//⑤ワープ魔法陣
	}

	set_chr( 12,226,	 6, 4,  -200,-150,  0,		  2,     0, 0,";")//②敵a ふぁいやこぼると
		chr_equip2( 12,	"eq_155",	"Bone_Head",	100,		0, 0, 0,	0, 0, 0);		// メガネ

	set_chr( 13,226,	 6, 4,  -200, 150,  0,		  2,     0, 0,";")//②敵b ふぁいやこぼると
		chr_equip2( 13,	"eq_155",	"Bone_Head",	100,		0, 0, 0,	0, 0, 0);		// メガネ

	set_chr( 14,255,	 6, 4,  -200,   0,  0,		  2,     0, 0,";")//②敵c もりこぼると
		chr_equip2( 14,	"eq_155",	"Bone_Head",	100,		0, 0, 0,	0,  0,  0);		// メガネ
		chr_equip2( 14,	"eq_103",	"Bone_Head",	103,		95, 0, 0,	0, 45,  0);		// 工事用安全帽
		chr_state_LV(14, 3);	// 8→11

	set_chr( 71,990,	 5, 4,  -200, 350,  0,		  0,040732, 3,"y9_98")	// ①扇風機-縦風b
	set_chr( 72,990,	 4, 3,   350, 200,  0,		  0,043207, 3,"x1_98")	// ②扇風機-横風b
	set_chr( 73,990,	 3, 4,   200,-350,  0,		  0,040732, 3,"y1_98")	// ③扇風機-縦風b
	set_chr( 74,990,	 4, 5,  -350,-200,  0,		  0,043207, 3,"x9_98")	// ④扇風機-横風b

	set_chr(170,990,	 4, 5, -1200,-200,  0,		  0,     0, 0,";8")	// →配置用null
	set_chr(171,990,	 4, 5,     0,-200,  0,		  0,     0, 0,";8")	// →配置用null
	set_chr(172,990,	 5, 4,  -200,1200,  0,		  0,     0, 0,";8")	// ↑配置用null
	set_chr(173,990,	 5, 4,  -200,   0,  0,		  0,     0, 0,";8")	// ↑配置用null
	set_chr(174,990,	 4, 3,  1200, 200,  0,		  0,     0, 0,";8")	// ←配置用null
	set_chr(175,990,	 4, 3,     0, 200,  0,		  0,     0, 0,";8")	// ←配置用null
	set_chr(176,990,	 3, 4,  -200,-1200, 0,		  0,     0, 0,";8")	// ↓配置用null
	set_chr(177,990,	 3, 4,  -200,   0,  0,		  0,     0, 0,";8")	// ↓配置用null

	set_chr(164,990,	 0, 0,     0,   0,  0,  	  0,     0, 8,"(M7?64 RF104 #7_71 #7_72 #7_73 #7_74 M6?64 SF104 #3_71 #3_72 #3_73 #3_74   );")	//⑤レバースイッチ

//■場面固有設定
	EV("EV_GenWind")
}

//--------------------------------------------------------------------
EV_BossBGM
{
	stop_BGM(30)
	wait(30)
	BGM(35)
}

//--------------------------------------------------------------------
EV_NormalBGM
{
	stop_BGM(30)
	wait(30)
	BGM(24)
}

//--------------------------------------------------------------------
EV_BossActivate1
{
	set_chr( 92,668,	 5, 4,  -150,   0,  0,		  0,      0, 8,"F1 WT?60 F107 (L1?9900 <EV_Warp_X> WT?15 K6_3 SF108 WT?60);")	//⑤ワープ魔法陣
	chr_equip_chr( 92, 1,"Bone_Hips", 100,  90,0,0,		0, 0, 0);
	color( 92,-1)		// 透明に
	F_set_chr( 92,		CF_NO_MINIMAP)	// ミニマップ非表示
	F_set_chr( 92,		CF_NO_SHADOW)	// かげなし
}

//--------------------------------------------------------------------
EV_BossFinish1
{
	color( 92, 30)
	F_reset_chr( 92,	CF_NO_MINIMAP)	// 宝箱 ミニマップ表示
}

//--------------------------------------------------------------------
EV_BossBoxFall1
{
	jump( 92,3, 24,-1,-1,1,150)
	wait_move(92)
	F_set( 107 )
}

//--------------------------------------------------------------------
EV_WarpGateVanish
{
	EFF_chr(24580, PLAYER1, 0, 100, 0, "Bone_Hips")
	EFF_chr(24580, PLAYER2, 0, 100, 0, "Bone_Hips")
	wait(25)
	SE(1321, 96) //ワープ魔法陣・スイッチで出現
	EFF_chr( 4232, 96, 0, 100, -1, "warp01")
	wait(5)
	color(66, -20)
	wait(20)
	delete(96)
	delete(92)
}

//--------------------------------------------------------------------
EV_GenWind
{
	if ( !F104 )
	{
		EFF_chr(21570,170, 270, 100, 0,"TG1")// →
		EFF_chr(21570,172, 180, 100, 0,"TG1")// ↑
		EFF_chr(21570,174,  90, 100, 0,"TG1")// ←
		EFF_chr(21570,176,   0, 100, 0,"TG1")// ↓
	}
	wait( 25 )

	if ( !F104 )
	{
		EFF_chr(21570,171, 270, 100, 0,"TG1")// →
		EFF_chr(21570,173, 180, 100, 0,"TG1")// ↑
		EFF_chr(21570,175,  90, 100, 0,"TG1")// ←
		EFF_chr(21570,177,   0, 100, 0,"TG1")// ↓
	}
	wait( 25 )

	loop
}


//--------------------------------------------------------------------
EV_Warp_X
{
	jump(PLAYER2,1,	10,	PLAYER1, 0, 0,	 150)
	jump(PET,1,	10,	PLAYER1, 0, 0,	 150)
	wait( 5)
	SE(291, PLAYER1) //ワープ魔法陣・ワープ
	EFF_chr(24580, PLAYER1, 0, 100, 0, "Bone_Hips")
	EFF_chr(24580, PLAYER2, 0, 100, 0, "Bone_Hips")

	color(PLAYER1, -10)	//表示
	color(PLAYER2, -10)	//表示
	color(PET, -10)	//表示
	wait(10)

	color(PLAYER1, 10)	//表示
	color(PLAYER2, 10)	//表示
	color(PET, 10)	//表示
	wait(10)
}

#EndScriptTable
//====================================================================

