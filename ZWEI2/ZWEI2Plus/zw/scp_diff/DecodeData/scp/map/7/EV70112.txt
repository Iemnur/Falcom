//====================================================================
//ステージトラップスクリプト
//[17011][異－メイン①]
//====================================================================

#ScriptTable

//--------------------------------------------------------------------
//■グローバルフラグ
// 2985		フードスロット
// Fx_711Food1 		宝箱（並）	飯

//■ルートフラグ 2096-2192
#FR_71x_RabitDied		2100	// うさぎが死んだ
#FR_711_RabitDone		2101	// うさぎを穴に追い込んだ1
#FR_712_RabitDone		2102	// うさぎを穴に追い込んだ2
#FR_712_FatDone			2103	// 体重ギミック成功 簡易スクリプトで使っているので変更不可
#FR_713_RabitDone		2104	// うさぎをお茶会へ到達させた
#FR_712_Talk1st			2105	// 

// 2109 メイン① ④ボタンスイッチを押した
// 2110 メイン① ①ボタンスイッチを押した
// 2111 メイン① ②ボタンスイッチを押した
// 2112 メイン① ③ボタンスイッチを押した

// 2115 メイン② 豆電球が同時に点灯した
// 2116 メイン② ③ボタンスイッチを押した
// 2117 メイン② うさぎ扉を開けた
// 2120 メイン③ うさぎ扉を開けた

// 2135 メイン③ レバースイッチで扉を開けた（初回）
// 2136 メイン③ ①樽

// 2150 メイン① ①壷
// 2151 メイン① ②壷
// 2152 メイン① ③壷

// 2160 メイン② ①壷
// 2161 メイン② ②ハニワ
// 2162 メイン② ③壷
// 2163 メイン② ④壷
// 2164 メイン② ⑤壷

// 2170 メイン③ ①壷
// 2171 メイン③ ②壷
// 2172 メイン③ ③壷
// 2173 メイン③ ④壷
// 2174 メイン③ ⑤壷

// 2149 スロット特例

//■ローカルフラグ
// 100 ①ボタンスイッチを押した
// 101 ②ボタンスイッチを押した
// 102 ③ボタンスイッチを押した

// 三月ウサギ
#TAKARA_CH	49
#IT_TAKARA	109		//◇109アナログ時計

// 宝の部屋
#WOODBOX_CH		48
#IT_WOODBOX		182	//∴182パイナップル

//--------------------------------------------------------------------
INIT
{
//環境SE
	SE(68,0)

//■地形
	F_set_chr(PLAYER1, CF_NO_FALL )
	F_set_chr(PLAYER2, CF_NO_FALL )
	F_set_chr(PET, CF_NO_FALL )

	set_obj2("mp70142",   3, 5,  -450, 450,  0,	 0) //
	set_obj2("mp70152",   3, 5,   450, 450,  0,	 0) //

	set_obj2("obx7000k",  3, 5,     0,-900,  0,   0) //↓
	set_obj2("obx7000k",  3, 5,     0,   0,  0, 180) //↑

	set_obj2("mp70082",   5, 5,  -450,-450,  0,	 0) //
	set_obj2("mp70102",   5, 5,  -450, 450,  0,	 0) //
	set_obj2("obx7000k",  5, 5,     0,   0,  0, 270) //→
	set_obj2("obx7000k",  6, 5,     0,-900,  0,   0) //↓

	set_obj("obx0514",	 3, 2,  -300,   0,  0,	 0) //穴

	set_chr(170,991,	 3, 5,  -300,-450,  0,	 0,0209, 0,";")	// 空気壁
	set_chr(171,991,	 3, 5,   300,-450,  0,	 0,0209, 0,";")	// 空気壁

	set_chr(172,991,	 5, 5,  -100,-300,  0,	 0,0602, 0,";")	// 空気壁
	set_chr(173,991,	 5, 5,   500,-800,  0,	 0,1802, 0,";")	// 空気壁
	set_chr(174,991,	 6, 5,   550,-800,  0,	 0,0302, 0,";")	// 空気壁
	set_chr(175,991,	 6, 5,   800,-100,  0,	 0,0216, 0,";")	// 空気壁
	set_chr(176,991,	 6, 5,  -450, 600,  0,	 0,2302, 0,";")	// 空気壁
	set_chr(177,991,	 5, 5,   100, 500,  0,	 0,0204, 0,";")	// 空気壁


//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
//■階段・扉
	set_chr( 90,990,	 6,10,     0, -50,  0,		180,  0201, 6,"K0_1;")	//①エントリ 
	set_obj("@obx0122a", 6,10,     0,   0,  0,		180)					//①アーチ（異１）	
	set_chr(190,1400,	 6,10,     0,   0,  0,		  0,   180, 0,";")		//アーチ（ダミー）

	set_chr( 91,990,	 3, 2,   200,   0,  0,		270,  0102, 6,"K0_0;")	//②エントリ 
	set_obj("@obx0112a", 3, 2,   150,   0,  0,		270)					//②階段上（異１）
	set_chr(191,1301,	 3, 2,   150,   0,  0,		  0,   270, 0,";")		//階段上（ダミー）

	set_chr( 92,990,	 3, 2,  1000,   0,  0,		 90,     0, 0,";")		//うさぎ穴前 出現のみ

	// チェックポイント
	set_chr( 89,990,	 3, 2,  -300,   0,  0,		  0,070411, 6,"k2_0")	//うさぎ穴前。兎の到達判定にも使用。
	set_chr( 93,990,	 6, 4,     0, 900,  0,		180,  0301, 6,"k3_0")	//球石付近A
	set_chr( 94,990,	 5, 5,     0,   0,  0,		 90,  0103, 6,"k4_0")	//球石付近B
	set_chr( 95,990,	 3, 4,     0, 900,  0,		180,  0301, 6,"k5_0")	//飯箱付近A
	set_chr( 96,990,	 3, 5,     0,   0,  0,		  0,  0301, 6,"k6_0")	//飯箱付近B

	// 扉
	set_chr( 50,509,	 7, 4,     0,-900,  0,		  7,   180, 0,";")	//③扉（異１） 閉鎖
	set_chr( 51,509,	 7, 3,  -900,   0,  0,		  7,    90, 0,";")	//④扉（異１） 閉鎖
	set_chr( 52,509,	 6, 3,     0, 900,  0,		  7,     0, 0,";")	//⑤扉（異１） 閉鎖
	set_chr( 53,509,	 6, 4,   900,   0,  0,		  8,    90, 6,";")	//⑥扉（異１） 一通
	set_chr( 54,509,	 3, 6,   900,   0,  0,		  7,    90, 0,";")	//⑦扉（異１） 閉鎖

//■スイッチ・看板
	if ( !F2110 )
	{
	// 初回
		set_chr( 55,570,	 8, 3,     0,   0,  0,		  6,     0, 5,"M6?99 M5_99 SF2110")	//①ボタンスイッチ
		set_chr(181,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F2110 O1_18 WT?10 C0_50 WT?20 M4_50 WT?30 C0_0;")	//③扉
	}
	else
	{
	// 押され
		set_chr( 55,570,	 8, 3,     0,   0,  0,		  7,     0, 3,";")	//①ボタンスイッチ
		MOT( 50, 6, 0)
	}


	if ( !F2111 )
	{
	// 初回
		set_chr( 56,570,	 8, 2,     0,   0,  0,		  6,     0, 5,"M6?99 M5_99 SF2111")	//②ボタンスイッチ
		set_chr(182,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F2111 O1_18 WT?10 C0_51 WT?20 M4_51 WT?30 C0_0;")	//④扉
	}
	else
	{
	// 押され
		set_chr( 56,570,	 8, 2,     0,   0,  0,		  7,     0, 3,";")	//②ボタンスイッチ
		MOT( 51, 6, 0)
	}


	if ( !F2112 )
	{
	// 初回
		set_chr( 57,570,	 6, 1,     0,   0,  0,		  6,     0, 5,"M6?99 M5_99 SF2112")	//③ボタンスイッチ
		set_chr(183,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F2112 O1_18 WT?10 C0_52 WT?20 M4_52 WT?30 C0_0;")	//⑤扉
	}
	else
	{
	// 押され
		set_chr( 57,570,	 6, 1,     0,   0,  0,		  7,     0, 5,";")	//③ボタンスイッチ
		MOT( 52, 6, 0)
	}



	if ( !F2109 )
	{
	// 初回
		set_chr( 58,570,	 4, 6,  -400,-400,  3,		  6,   270, 5,"M6?99 M5_99 SF2109")	//④ボタンスイッチ
		set_chr(185,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F2109 O1_18 WT?10 C0_54 WT?20 M4_54 WT?30 C0_0;")	//⑦扉
	}
	else
	{
	// 押され
		set_chr( 58,570,	 4, 6,  -400,-400,  3,		  7,   270, 5,";")	//③ボタンスイッチ
		MOT( 54, 6, 0)
	}

	set_chr(111,657,	 4, 8,  -375, 375,  0,		  0,   270, 0,";")	//④ハテナ看板
	set_chr(112,804,	 4, 8,  -375, 375,115,		  0,   270, 8,"(L2?99 [9991うさぎは臆病だが寂しがり。\n追い立てなければ寄って来る。] WT?20 L2!99 [9903] WT?30);")	//④看板


//■ハニワ・壷

	if ( !F2150 )
	{
		set_chr( 40,802,	 5, 7,   200,-900,  0,		  2,   180, 0,"I_$$$1 SF2150 V4_140;")	//①壷
		set_chr(140,811,	 5, 7,   200,-900,  0,		 -1,   180, 0,";")
	}
	else
	{
		set_chr(140,811,	 5, 7,   200,-900,  0,		  0,   180, 0,";")
	}


	if ( !F2151 )
	{
		set_chr( 41,802,	 5,10,   250,   0,  0,		  2,    90, 0,"I_$$$1 SF2151 V4_141;")	//②壷
		set_chr(141,811,	 5,10,   250,   0,  0,		 -1,    90, 0,";")
	}
	else
	{
		set_chr(141,811,	 5,10,   250,   0,  0,		  0,    90, 0,";")
	}


	if ( !F2152 )
	{
		set_chr( 42,802,	 5, 3,  -200,-900,  0,		  2,     0, 0,"I_$$$1 SF2152 V4_142;")	//③壷
		set_chr(142,811,	 5, 3,  -200,-900,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(142,811,	 5, 3,  -200,-900,  0,		  0,     0, 0,";")
	}

//■宝箱
	// 飯
	if( !Fx_711Food1 )
		set_chr( WOODBOX_CH,562,	 3, 6,     0,   0,  0,		  6,   180, 20,"<TK_WOODBOX><EV_SetGetFood1>;")
	else
		set_chr( WOODBOX_CH,562,	 3, 6,     0,   0,  0,		  7,   180, 0,";")

//■罠・障害物
//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
	set_chr(120,627,	 6, 3,   900, 350,  0,		  0,    90, 0,";")	//柵小
	color2(120, 61,73,100, 0,0,0)	// 異次元の柵の色

	set_chr(121,627,	 6, 4,   900,-350,  0,		  0,    90, 0,";")	//柵小
	color2(121, 61,73,100, 0,0,0)	// 異次元の柵の色

	set_chr(122,627,	 6, 3,   350, 900,  0,		  0,     0, 0,";")	//柵小
	color2(122, 61,73,100, 0,0,0)	// 異次元の柵の色

	set_chr(123,627,	 7, 3,  -350, 900,  0,		  0,     0, 0,";")	//柵小
	color2(123, 61,73,100, 0,0,0)	// 異次元の柵の色

	set_chr( 65,710,	 6, 7,     0,   0,  0,		  2,     0, 0,"#3_80;")	//①球石（破壊可）
	set_chr( 66,710,	 6, 4,     0,   0,  0,		  2,     0, 0,"#3_81;")	//②球石（破壊可）

//■敵
	set_chr( 7,279,		 6, 8,   900,   0,  0,		  2,     0, 0,";")	//②敵 くろうぃすぷ
	set_chr( 9,145,		 6, 7,     0,-900,  0,		  2,     0, 0,";")	//③敵b とらんぷまん

	set_chr(11,279,		 7, 6,     0,-300,  0,		  2,     0, 0,";")	//④敵 くろうぃすぷ

	set_chr(13,151,		 8, 4,     0,   0,  0,		  2,    90, 0,";")	//⑤敵 そるじゃー
	set_chr(14,151,		 7, 2,     0,   0,  0,		  2,     0, 0,";")	//⑥敵 そるじゃー
	set_chr(15,151,		 6, 2,     0,   0,  0,		  2,     0, 0,";")	//⑦敵 そるじゃー

	set_chr(17,145,		 7, 3,   200,-200,  0,		  2,     0, 0,";")	//⑧敵a とらんぷまん
	set_chr(18,145,		 6, 3,     0,   0,  0,		  2,     0, 0,";")	//⑧敵b とらんぷまん

	set_chr(20,279,		 5, 4,  -900,   0,  0,		  2,   270, 0,";")	//⑨敵 くろうぃすぷ
	set_chr(21,145,		 3, 4,     0,   0,  0,		  2,   180, 0,";")	//⑩敵 とらんぷまん
	set_chr(22,151,		 3, 3,  -900, 200,  0,		  2,   270, 0,";")	//⑪敵 そるじゃー
	set_chr(23,145,		 4, 3,   200,-900,  0,		  2,   180, 0,";")	//⑫敵 とらんぷまん

//■イベント

	set_chr( 80,990,	 6, 7,     0,   0,  0,		  0,013131, 7,"z9_98")	// 揺れ浮上
	set_chr( 81,990,	 6, 4,     0,   0,  0,		  0,013939, 7,"z9_98")	// 揺れ浮上
	set_chr( 82,990,	 4, 9,     0,   0,  0,		  0,071111, 6,"!F1 M2_1 #3_85 #8_88;")

	// ふわ足場
//	set_chr( 86,990,	 3, 5,     0, -450,  0,	 0, 010405, 7,"z5_01")	// 揺れ浮上 うさぎ専用
	set_chr( 86,990,	 3, 5,     0, -450,  0,	 0, 010405, 7,"z5_98")	// 揺れ浮上 みんな用

	EV("EV_SphereStone")
	EV("EV_GenWind")

	//三月うさぎ
	// 89,92 穴
	// 1,49,88,87,86,85
	if ( !FR_71x_RabitDied )
	{
		if ( !FR_711_RabitDone )
		{
			//■敵
			set_chr( 1,289,		 4,10,   350,   0,  0,		  6,   135, 0,"<EV_RabitFinish>;")	//①敵 ワーラビット② 三月ウサギ  Lv15
		//	set_chr( 1,289,		 3, 6,     0,-450,  0,		  2,   180, 0,"<EV_RabitFinish>;")	//①敵 ワーラビット② デバッグ－崖前
		//	set_chr( 1,289,		 4, 2,  -900,   0,  0,		  2,   180, 0,"<EV_RabitFinish>;")	//①敵 ワーラビット② デバッグ－出口前


			if(IT_TAKARA<0)
			{
				set_chr( 49,560, 4,10,   550,   0,  0,  	 6,270,20,"<TK_TAKARA>;")	//①宝箱（上）ロック
				set_chr(187,990, 0, 0,     0,   0,  0,		  0,     0, 8,"F1 [0103] #3_88 WT?10 O1_18 <EV_RabitBoxFall> WT?27 #2_49;")	//宝箱を落とし、開けるようにする
			}
			else
			{
				set_chr( 49,560, 4,10,   550,   0,  0,  	 7,270, 0,";")				//①宝箱（上）空
				set_chr(187,990, 0, 0,     0,   0,  0,		  0,     0, 8,"F1 [0103] #3_88 WT?10 O1_18 <EV_RabitBoxFall> WT?27;")	//空箱
			}


			chr_equip_chr( 49, 1,"Bone_Spine", 100,   90,0,0,		0,  250, 0);	//背負う箱

			//■イベント
			// セリフを出しているのは宝箱
			set_chr( 85,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"#3_49 (WT?30 Le?0100 [0120お茶会に遅れちゃう！] WT?60[0103] WT?60 Le?0100 [0120出口どこよ！？]WT?60[0103] WT?120);")//せりふ初
			set_chr( 88,990,	 0, 0,     0,   0,  0,		  0,     0, 3,"#3_49 (WT?30 L9?0100 [0120お茶会に遅れちゃう！] WT?60[0103] WT?60 L9?0100 [0120出口どこよ！？]WT?60[0103] WT?120);")//せりふ後

			// 到達判定
			set_chr( 87,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"L2?8901 !F1 O1_18 D0_49 D0_1 <EV_Set711RabitDone> [0103] [8910さようなら～] WT?60[8903];")	// うさぎ到達


			EV("EV_RabitInit")
		}
	}

}

//--------------------------------------------------------------------
EV_RabitInit
{
	color( 49,-1)		// 透明に
	F_set_chr( 49,		CF_NO_MINIMAP)	// 宝箱 ミニマップ非表示
	F_set_chr( 49,		CF_NO_CSP)
}

//--------------------------------------------------------------------
EV_RabitFinish
{
	color( 49,30)		// 不透明に
	F_reset_chr( 49,	CF_NO_MINIMAP)	// 宝箱 ミニマップ表示
	F_reset_chr( 49,	CF_NO_CSP)
	F_set(FR_7x_RabitDied);
}

//--------------------------------------------------------------------
EV_RabitBoxFall
{
	// 宝箱落下
	jump( 49,3, 24,-1,-1,0,150)
	wait_move(49)
}

//--------------------------------------------------------------------
EV_Set711RabitDone
{
	F_set(FR_711_RabitDone)
}

//--------------------------------------------------------------------
EV_SetGetFood1
{
	F_set(Fx_711Food1)
}

//--------------------------------------------------------------------
EV_SphereStone
{
	if ( !F65 )
	{
		EFF_chr(21520, 65, 0, 100, 0,"charbase0")
	}

	if ( !F66 )
	{
		EFF_chr(21520, 66, 0, 100, 0,"charbase0")
	}

	wait(25)
	loop
}
//--------------------------------------------------------------------
EV_GenWind
{
	EFF_chr(4300, 86,   0, 100, 0,"TG1")//
	wait( 50 )

	loop
}

#EndScriptTable
//====================================================================
