//====================================================================
//ステージトラップスクリプト
//[16031][山－ボス①]
//====================================================================

#ScriptTable

//--------------------------------------------------------------------
//■グローバルフラグ
// 2976		フードスロット
// Fx_631Food1 ボス① 飯

//■ルートフラグ 2096-2192
// 2100 ボス② 中ボス
#FR_631_Delivered		2101	//	笠を届けた
#FR_631_GoenInit		2102
// 2103 ボス③ 宝箱発掘
// 2104 ボス③ 笠地蔵達成
// 2105 ボス③ ミニキノコ到達
// 2106 ボス① 最初のキノコから笠が外れた
// 2107 ボス② ⑩ボタンスイッチ

// 2120 ボス① ⑦樽
// 2121 ボス① ⑨樽
// 2122 ボス① ⑩岩

// 2132 ボス② ⑦岩
// 2133 ボス② ⑧火の柱a
// 2134 ボス② ⑧火の柱b
// 2135 ボス② 爆弾タル

// 2140 ボス③ ④樽
// 2141 ボス③ ⑤ヒビ壁a
// 2142 ボス③ ⑤ヒビ壁b

// 2150 ボス① ①壷
// 2151 ボス① ②壷
// 2152 ボス① ③壷
// 2153 ボス① ④壷
// 2154 ボス① ⑤壷

// 2160 ボス② ①ハニワ
// 2161 ボス② ②ハニワ
// 2162 ボス② ③ハニワ
// 2163 ボス② ④ハニワ
// 2164 ボス② ⑤ハニワ
// 2165 ボス② ⑥ハニワ
// 2166 ボス② ⑦ハニワ

// 2170 ボス③ ①壷
// 2171 ボス③ ②壷
// 2172 ボス③ ③壷
// 2173 ボス③ ④壷
// 2174 ボス③ ⑤壷

//■ローカルフラグ
// 100 ⑨敵が出現
// 101 ⑪敵⑫敵が出現
// 102 ②敵が出現
// 103 ①敵が活動開始
// 110 雪球とプレイヤーの距離が一定範囲内

#WOODBOX_CH		48
#IT_WOODBOX		178		//∴178ターキー

//--------------------------------------------------------------------
INIT
{
//環境SE
	SE(51,0)

//■地形

//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
//■階段・扉
	set_chr( 90,990,	 7,10,     0,   0,  0,		180,  0201, 6,"K2_10480;")	//①エントリ 星降りの里分岐（昼）
	set_obj("@ob62031a", 7,10,     0,   0,  0,		180)						//①アーチ（山）
	set_chr(190,1400,	 7,10,	   0,   0,  0,		  0,   180, 0,";")			//アーチ（ダミー）

	set_chr( 91,990,	 2, 2,     0,   0,  0,		270,  0102, 6,"K0_0;")		//②エントリ ボス②
	set_obj("@ob62021a", 2, 2,     0,   0,  0,		270)						//②階段上（山）
	set_chr(191,1301,	 2, 2,	   0,   0,  0,		  0,   270, 0,";")			//階段上（ダミー）

	// 地形
	set_obj2("mp62001",   7, 8,  -450, 450,  0,	 0) //
	set_obj2("mp62011",   7, 8,   450, 450,  0,	 0) //
	set_obj2("mp62161",   7, 7,  -450, 450,  0,	 0) //

	set_obj2("mp62021",   9, 6,  -450,-450,  0,	 0) //
	set_obj2("mp62031",   9, 6,   450,-450,  0,	 0) //
	set_obj2("mp62161",   9, 6,  -450, 450,  0,	 0) //

//■スイッチ・看板
	set_chr( 55,804,	 7, 9,     0,-975, 0,		  0,     0, 8,"(L2?99 [9991ご縁がありますように。] WT?30 L2!99 [9903] WT?30);")	//①看板
	set_chr( 56,655,	 6, 4,  -225,-225,  0,		  4,     0, 0,";")	//②順路案内
	set_chr( 57,804,	 6, 4,  -425,-225,  0,		  0,     0, 8,"(L2?99 [9991山頂方面] WT?30 L2!99 [9903] WT?30);")	//①


//■ハニワ・壷
	if ( !F2150 )
	{
		set_chr( 40,802,	 6, 9,  -200,-200,  0,		  2,    60, 0,"I_$$$1 SF2150 V4_140;")	//①壷
		set_chr(140,811,	 6, 9,  -200,-200,  0,		 -1,    60, 0,";")
	}
	else
	{
		set_chr(140,811,	 6, 9,  -200,-200,  0,		  0,    60, 0,";")
	}


	if ( !F2151 )
	{
		set_chr( 41,802,	 7, 5,     0,   0,  0,		  2,   145, 0,"I_$$$1 SF2151 V4_141;")	//②壷
		set_chr(141,811,	 7, 5,     0,   0,  0,		 -1,   145, 0,";")
	}
	else
	{
		set_chr(141,811,	 7, 5,     0,   0,  0,		  0,   145, 0,";")
	}


	if ( !F2152 )
	{
		set_chr( 42,802,	 7, 2,   200, 900,  0,		  2,   245, 0,"I_$$$1 SF2152 V4_142;")	//③壷
		set_chr(142,811,	 7, 2,   200, 900,  0,		 -1,   245, 0,";")
	}
	else
	{
		set_chr(142,811,	 7, 2,   200, 900,  0,		  0,   245, 0,";")
	}


	if ( !F2153 )
	{
		set_chr( 43,802,	 8, 4,   900, 200,  0,		  2,   180, 0,"I_$$$1 SF2153 V4_143;")	//④壷
		set_chr(143,811,	 8, 4,   900, 200,  0,		 -1,   180, 0,";")
	}
	else
	{
		set_chr(143,811,	 8, 4,   900, 200,  0,		  0,   180, 0,";")
	}


	if ( !F2154 )
	{
		set_chr( 44,802,	 6, 3,   200, 900,  0,		  2,   245, 0,"I_$$$1 SF2154 V4_144;")	//⑤壷
		set_chr(144,811,	 6, 3,   200, 900,  0,		 -1,   245, 0,";")
	}
	else
	{
		set_chr(144,811,	 6, 3,   200, 900,  0,		  0,   245, 0,";")
	}

//■宝箱
	if ( !FR_631_GoenInit )
	{
		F_reset( Fx_Goen )
		F_set( FR_631_GoenInit )
	}

	if ( !Fx_Goen )
	{
		set_chr( 49,562,	 7, 9,  -100,-800,  0,		  0,   270, 5,"I_0005 <EV_SetGetGoen>;")	//①木箱
	}
	else
	{
		set_chr( 49,562,	 7, 9,  -100,-800,  0,		  7,   270, 3,";")	//①木箱
	}


	if ( !Fx_631Food1 )
		set_chr( WOODBOX_CH,562,	7, 1,     0,  50,  0,		  6,     0,20,"<TK_WOODBOX><EV_SetGetFood1>;")	//②木箱
	else
		set_chr( WOODBOX_CH,562,	7, 1,     0,  50,  0,		  7,     0, 0,";")	//②木箱



//■罠・障害物

	set_chr( 78, 651,		 7, 9,	-125,-575,  1,		  0,   315, 3,"") //地蔵

	set_chr(110,627,	 3, 3,     0,-900,  0,		  0,     0, 0,";")	// 柵小
		color2(110, 41,81,100, 0,0,0)

	if ( !F2104 )
	{
		set_chr( 70,643,	 5, 8,     0,   0,  1,		  6,     0, 0,";")	//①きのこ

		set_chr( 69,643,	 7, 4,  -200,   0,  1,		  6,     0, 0,";")	//②きのこ
			chr_equip2(69,	"eq_162",	"obx0194", 110,		-90,0,0,	0,0,380);	// 笠
		set_chr( 68,643,	 8, 3,  -900,-200,  1,		  6,     0, 0,";")	//③きのこ
			chr_equip2(68,	"eq_162",	"obx0194", 110,		-90,0,0,	0,0,380);	// 笠
		set_chr( 67,643,	 8, 2,   200,-200,  1,		  6,     0, 0,";")	//④きのこ
			chr_equip2(67,	"eq_162",	"obx0194", 110,		-90,0,0,	0,0,380);	// 笠
		set_chr( 66,643,	 4, 4,     0,   0,  1,		  6,     0, 0,";")	//⑤きのこ
			chr_equip2(66,	"eq_162",	"obx0194", 110,		-90,0,0,	0,0,380);	// 笠
		set_chr( 65,643,	 4, 3,     0,-900,  1,		  6,     0, 0,";")	//⑥きのこ
			chr_equip2(65,	"eq_162",	"obx0194", 110,		-90,0,0,	0,0,380);	// 笠
	}

	if ( !F2120 )
		set_chr( 73,630,	 5, 4,     0,-375,  0,		  2,    60, 0,"I_$$$1 SF2120;")	//⑦樽
	else
		set_chr( 73,630,	 5, 4,     0,-375,  0,		  2,    60, 0,"I_$$$1;")	//⑦樽


	if ( !F2121 )
		set_chr( 75,630,	 2, 4,  -350, 350,  0,		  2,   270, 0,"I_$$$1 SF2121;")	//⑨樽
	else
		set_chr( 75,630,	 2, 4,  -350, 350,  0,		  2,   270, 0,"I_$$$1;")	//⑨樽


	// 岩と雪球
	if ( !F2122 )
	{
		set_chr( 76,642,	 3, 3,   400,-900,  0,		  2,     0, 0,"I_$$$2 #8_77 SF2122;")	//⑩岩
	}
	set_chr( 77,667,	 3, 2,   400,-450,800,		 -1,     0, 0,"WT?40 V1_99 #8_99 M3_99 <EV_SnowBallFall> WT?5 (T0_99 M+_99 WT?10 Y5_-2750 <EV_CamQuake2> M-_99 WT?15 T4_99 M+_99 WT?10 Y5_2750 <EV_CamQuake2>  M-_99 WT?15);") //⑪雪球
	color(77, -1)	//非表示


//■敵
	if ( !FR_631_Delivered )
	{
		if ( !F2106 )
		{
			// ①敵は画面外の場所に配置されていて、EV_ActivateEvemy1でキノコの上に移動する
			set_chr(  1,132,	10,10,     0,   0,  0,		 -1,   270, 0,";") //①敵 いちもくれん

			set_chr(  2,373,	 5, 8,     0,   0,  0,		  2,     0, 0,"SF2106 V3_1 <EV_ActivateEvemy1>;")	// ①敵 当たり用ダミー
				chr_equip2(2,	"eq_162",	"csp1",117,	-90,0,0,	0,0,-30);				// 笠 
				chr_equip_chr( 2, 70, "obx0194", 100,	0,0,0,	0,0,350);	// 笠

			// ①敵
			F_set_chr( 1,CF_NO_MINIMAP)	// ミニマップ非表示
			F_set_chr( 1,CF_NO_HPBAR)	// HPバー非表示
			MOT( 1, 6, 0)		// イベント用待機

			// 373ダミー
			F_set_chr( 2,CF_NO_MINIMAP)	// ミニマップ非表示
			F_set_chr( 2,CF_NO_HPBAR)	// HPバー非表示
			F_set_chr( 2,CF_NO_SHADOW)	// 影描画なし
			F_set_chr( 2,CF_NO_DROPITEM)  // ドロップアイテムを落とさない
		}
		else
		{
			set_chr(  1,132,	 5, 8,  -200,-200,  0,        0,   270, 0,";") //①敵 いちもくれん
		}

		set_chr(  3,374,	 5, 8,     0,   0,  0,		  2,     0, 0,";")		// きのこ 装着用ダミー
			chr_equip2(3,	"eq_164",	"csp1",117,	-90,0,0,	0,0,-30);				// 花笠青 
			chr_equip_chr( 3, 70, "obx0194", 100,	0,0,0,	0,0,350);	// 花笠青

		set_chr(  5,132,	 9, 5,     0, 600,  0,		  2,     0, 0,"<EV_ActivateHanagasa>;") //②敵 いちもくれん
			chr_state_LV(5, 1);
			chr_equip2( 5,	"eq_164",	"Bone_Kasa",110,	  0,0,0,	0,5,0);				// 花笠青 

		set_chr(  4,374,	 9, 6,     0,-400,  0,		  2,     0, 0,";")		// 運搬用ダミー
			chr_equip2(4,	"eq_164",	"csp1",117,	-90,0,0,	0,0,-30);				// 花笠青 
			chr_equip_chr( 4, 5, "Bone_Kasa", 100,	0,0,0,	0,30,-60);	// 笠


		// 374ダミー1
		color(3, -1)	//非表示
		F_set_chr( 3,CF_NO_CSP)	//
		F_set_chr( 3,CF_NO_MINIMAP)	// ミニマップ非表示
		F_set_chr( 3,CF_NO_HPBAR)	// HPバー非表示
		F_set_chr( 3,CF_NO_SHADOW)	// 影描画なし
		F_set_chr( 3,CF_NO_DROPITEM)  // ドロップアイテムを落とさない

		// 375ダミー2
		color(4, -1)	//非表示
		F_set_chr( 4,CF_NO_CSP)	//
		F_set_chr( 4,CF_NO_MINIMAP)	// ミニマップ非表示
		F_set_chr( 4,CF_NO_HPBAR)	// HPバー非表示
		F_set_chr( 4,CF_NO_SHADOW)	// 影描画なし
		F_set_chr( 4,CF_NO_DROPITEM)  // ドロップアイテムを落とさない

	}
	else
	{
		set_chr(  1,132,	 5, 8,  -200,-200,  0,        0,   270, 0,";") //①敵 いちもくれん

		if ( !F2104 )
		{
			set_chr(  3,374,	 5, 8,     0,   0,  0,		  2,     0, 0,";")		// きのこ 装着用ダミー
				chr_equip2(3,	"eq_164",	"csp1",117,	-90,0,0,	0,0,-30);				// 花笠青 
				chr_equip_chr( 3, 70, "obx0194", 100,	0,0,0,	0,0,350);	// 花笠青

			// 374ダミー1
			F_set_chr( 3,CF_NO_CSP)	//
			F_set_chr( 3,CF_NO_MINIMAP)	// ミニマップ非表示
			F_set_chr( 3,CF_NO_HPBAR)	// HPバー非表示
			F_set_chr( 3,CF_NO_SHADOW)	// 影描画なし
			F_set_chr( 3,CF_NO_DROPITEM)  // ドロップアイテムを落とさない
		}

		set_chr(  5,132,	 9, 5,     0, 600,  0,		  2,     0, 0,";") //②敵 いちもくれん
			chr_state_LV(5, 1);

	}

	set_chr(  7,132,	 6, 5,     0, 900,  0,		  2,   180, 0,";") //③敵 いちもくれん

	set_chr( 10,273,	 6, 4,   900,   0,  0,		  2,    90, 0,";") //④敵 やまつつき
	set_chr( 11,111,	 6, 4,     0,-900,  0,		  2,     0, 0,";") //⑤敵 すざく

	set_chr( 13,141,	 7, 3,     0,   0,  0,		  2,     0, 0,";") //⑥敵 れんごくぐるま
	set_chr( 14,141,	 8, 4,     0,   0,  0,		  2,     0, 0,";") //⑦敵 れんごくぐるま

	set_chr( 15,144,	 5, 6,  -200,-900,500,		 -1,     0, 8,"F102 V1_99;") //⑧敵 くまこぷたー

	set_chr( 16,132,	 4, 4,  -200,-200,  0,		 -1,   270, 8,"F100 V1_99;") //⑨敵 いちもくれん

	set_chr( 18,144,	 2, 3,  -200, 600,  0,		  2,     0, 0,";") //⑩敵a くまこぷたー
	set_chr( 19,144,	 2, 4,  -200,-600,  0,		  2,   180, 0,";") //⑩敵b くまこぷたー

	set_chr( 21,141,	 4, 3,  -450,-200,  0,		 -1,     0, 8,"F101 V3_99;") //⑪敵a れんごくぐるま
	set_chr( 22,141,	 4, 2,  -450, 200,  0,		 -1,   180, 8,"F101 V3_99;") //⑪敵b れんごくぐるま

	set_chr( 24,213,	 9, 5,     0, 900,  1,		 -2,   135, 0,";")	//⑬敵 おとないえてぃ

//■イベント
	set_chr( 80,990,	 4, 4,     0,   0,  0,		  0,071111, 6,"SF100;")	//⑨敵エリア
	set_chr( 81,990,	 4, 3,  -200,-900,  0,		  0,070804, 6,"SF101;")	//⑪敵⑫敵エリア
	set_chr( 82,990,	 5, 6,  -200,-200,  0,		  0,070808, 6,"SF102;")	//②敵エリア

	if ( !FR_631_Delivered )
	{
		set_chr( 83,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F2106 L1?0470 C0_70 <EV_GiveHanagasa> WT?30 C0_0;")	//②敵エリア
	}

	// 雪球距離
	set_chr(180,990,	 0, 0,   0, 0, 0,   0,		  0,     9,"RF110 Ly?7700 SF110")

//■場面固有設定



	EV("EV_SnowFall")
}

//-------------------------------------------------------------------
EV_SnowFall
{
	EFF_chr(4292, 0, 0,100, -1, "charbase0" )
	wait( 50 )
	loop
}

//--------------------------------------------------------------------
EV_ActivateEvemy1
{
	// ①敵
	F_reset_chr( 1,CF_NO_MINIMAP)	// ミニマップ表示
	F_reset_chr( 1,CF_NO_HPBAR)	// HPバー表示
	MOT( 1, 2, 0)		// 待機
	jump( 1, 1, 1, 70, 0, 250,0)
	wait_move(1);

	jump( 1, 2, 25, 1, 1,175,175)
	wait_move(1);
}

//--------------------------------------------------------------------
EV_ActivateHanagasa
{
	color(4, 5)	//表示
	F_reset_chr( 4,CF_NO_CSP)	//
	F_reset_chr( 4,CF_NO_MINIMAP)	// ミニマップ非表示
}

//--------------------------------------------------------------------
EV_GiveHanagasa
{
	EV_begin()

	F_set(FR_631_Delivered)

	jump( 4, 1, 45, 3, 0, 0, 250)
	wait_move(4);
	color(4, -1)	//表示

	color(3, 1)		//表示
	SE(18,0)	// トラップ解除
	wait(30);


	EV_end()
}

//--------------------------------------------------------------------
EV_SnowBallFall
{
	// 雪球落下
	color(77, 15)	//表示
	jump( 77,3, 44,-1,-1,200,600)
	wait_move(77)
	CAM_quake("2828")
}

//--------------------------------------------------------------------
EV_CamQuake1
{
	if (F110)
	{
		CAM_quake("4646")
	}
}

//--------------------------------------------------------------------
EV_CamQuake2
{
	if (F110)
	{
		CAM_quake("3737")
	}
}

//--------------------------------------------------------------------
EV_CamQuake3
{
	if (F110)
	{
		CAM_quake("2828")
	}
}

//--------------------------------------------------------------------
EV_SetGetFood1
{
	F_set(Fx_631Food1)
}

//--------------------------------------------------------------------
EV_SetGetGoen
{
	F_set( Fx_Goen )
}

#EndScriptTable
//====================================================================

