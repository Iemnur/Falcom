//====================================================================
//ステージトラップスクリプト
//[16022][山－武器②]
//====================================================================

#ScriptTable

//--------------------------------------------------------------------
//■グローバルフラグ・ルートフラグはev60211.txt参照

// 助けたコボルテスを⑤扉の前までつれてゆくと扉を開けるキャラ劇を作る

//■ローカルフラグ
// 100 川流れ開始
// 101 ④敵が行動開始
// 102 ①敵が生存＆流れ丸太停止

//x 104 ⑤レバースイッチを押した

// 105 ①敵が⑤扉付近まで行った
// 106 ①敵が川の終点間際まで到達

#PARTNER 	255
#PET 		254
#RAGNA 		0
#PIPIRO		1
#POCKLE		2


#WOODBOX_CH		49
#IT_WOODBOX		216		//○216爆弾
#NUM_WOODBOX	3


#TAKARA_CH	48
#IT_TAKARA	234		//◇234 アクセスロット⑤

//--------------------------------------------------------------------
INIT
{
//環境SE
	SE(51,0)

//■地形

	set_obj2("mp61001",   0, 6,   450,-450,  0,	 0) //→
	set_obj2("mp61021",   0, 6,   450, 450,  0,	 0) //→

	set_obj("obx0044",	 4, 6,     0,   0,  0,  	180) //立体交差用橋
	set_obj("obx0524",	 9, 5,     0,   0,  0,	  0)	//穴大

	// 縁
	set_chr(125,768,	 3, 7,     0,-850,  0,		  0,     0, 0,";")	//山用渓流足場
	set_chr( 96,768,	 8, 4,     0, 850,  0,		  0,     0, 0,";")	//山用渓流足場ク このブロックは滑落の復帰ポイントになるのでNoをかえないように

	// 足場
	set_chr(150,768,	 3, 6,  -250, 200, 25,		  0,     0, 0,";")	//山用渓流足場
	set_chr(151,768,	 2, 6,  -550,-175, 25,		  0,     0, 0,";")	//山用渓流足場
	set_chr(152,768,	 1, 6,   550, 175, 25,		  0,     0, 0,";")	//山用渓流足場
	set_chr(153,768,	 6, 5,   250, 175, 25,		  0,    90, 0,";")	//山用渓流足場
	set_chr(155,708,	 7, 6,  -150, 235, 25,		  0,     0, 0,";")	//水際ブロック
	set_chr(156,708,	 8, 5,     0, 250, 25,		  0,     0, 0,";")	//水際ブロック

	// 落下丸太
	set_chr( 70,708,	 4, 6,   250,  50,350,		  2,    90, 8,"M0?99 <EV_MarutaFall> X3_300 X4_300 X5_600 X3_300 Y5_400 Y6_1000 Y5_400 X5_400 X6_1000 X5_400 Y5_-400 Y6_-1000 Y5_-400 X5_400 X6_1000 X5_400 Y5_400 Y6_1100 Y5_400 X5_400 X6_1400 X5_500 X3_300 X1_100 SF102;")	//水際ブロック
		F_set_chr(70,CF_NO_CLIP2)

	// 丸太殴り振動
	set_chr(123,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"M3?70 <EV_HitMarutaYure> M4?70 <EV_HitMarutaYure> M5?70 <EV_HitMarutaYure> M0?70 <EV_HitMarutaYure> ;")


/  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
//■階段・扉
	set_chr( 90,990,	 4, 9,     0,   0,  0,		 90,  0102, 6,"K0_1;")		//①エントリ 武器①
	set_obj("@ob61011a", 4, 9,     0,   0,  0,		 90)						//①階段下（山）
	set_chr(190,1300,	 4, 9,	   0,   0,  0,		  0,    90, 0,";")			//階段下（ダミー）

	set_chr( 91,990,	10, 3,     0,   0,  0,		 90,  0102, 6,"K0_0;")		//②エントリ 武器③
	set_obj("@ob61021a",10, 3,     0,   0,  0,		 90)						//②階段上（山）
	set_chr(191,1301,	10, 3,	   0,   0,  0,		  0,    90, 0,";")			//階段上（ダミー）

	// チェックポイント 崖
	set_chr(102,990,	 8, 5,   500,   0,  0,		  0,070209, 6,"k6_0")
	set_chr( 97,990,	 9, 5,   900,   0,  0,		270,070206, 6,"k7_0")

	set_chr( 50,1207,	 4, 4,     0,-900,  0,		  3,   180, 6,";")	//③扉（山２）自由
	set_chr( 51,1207,	 8, 4,     0,-900,  0,		  8,   180, 6,";")	//④扉（山２）一通
	set_chr( 52,1207,	 9, 3,     0,-400,  0,		  7,     0, 0,";")	//⑤扉（山２）閉鎖

//■スイッチ・看板
	set_chr( 60,804,	 6, 5,   250, 450,100,		  0,   180, 8,"(L2?99 [9991危険！＿このさき大穴] WT?30 L2!99 [9903] WT?30);")	//①看板

	set_chr( 61,672,	 6, 4,     0, 325,  0,		  0,   180, 6,"<EV_JUMP2>")		//②ジャンプ台
	set_chr( 62,672,	 7, 4,   -50,   0,  0,		  0,   270, 6,"<EV_JUMP3>")		//③ジャンプ台
	set_chr( 63,650,	 3, 4,   700,-250,  0,		  2,     0, 0,";"); //④苗床a
	set_chr( 64,650,	 3, 4,   700, 250,  0,		  2,     0, 0,";"); //④苗床b

	if ( !F2101 )
	{
	// 初回
		set_chr( 58,570,	 4, 3,  -250,-250,  0,		  6,     0, 5,"M6?99 M5_99 SF2101;")	//⑤ボタンスイッチ
		set_chr( 74,990,	 4, 6,   600,   0,  0,		  0,     0, 8,"F2101 O1_18 WT?10 C0_51 WT?20 M4_51 WT?35 C0_0;")//④扉を開く			// 風⑤の原点
	}
	else
	{
	// 押され
		set_chr( 58,570,	 4, 3,  -250,-250,  0,		  7,     0, 3,";")	//⑤ボタンスイッチ
		MOT( 51, 6, 0)
		set_chr( 74,990,	 4, 6,   600,   0,  0,		  0,     0, 3,";")//④扉を開く			// 風⑤の原点
	}



//■ハニワ・壷


	if ( !F2160 )
	{
		set_chr( 40,802,	 2, 6,   900, 325,  0,		  2,   120, 0,"I_$$$1 SF2160 V4_140;")	//①壷
		set_chr(140,811,	 2, 6,   900, 325,  0,		 -1,   120, 0,";")
	}
	else
	{
		set_chr(140,811,	 2, 6,   900, 325,  0,		  0,   120, 0,";")
	}


	if ( !F2161 )
	{
		set_chr( 41,802,	 4, 7,   350, 350,  0,		  2,   250, 0,"I_$$$1 SF2161 V4_141;")	//②壷
		set_chr(141,811,	 4, 7,   350, 350,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(141,811,	 4, 7,   350, 350,  0,		  0,   250, 0,";")
	}


	if ( !F2162 )
	{
		set_chr( 42,802,	 4, 3,  -350, 150,  0,		  2,   100, 0,"I_$$$1 SF2162 V4_142;")	//③壷
		set_chr(142,811,	 4, 3,  -350, 150,  0,		 -1,   100, 0,";")
	}
	else
	{
		set_chr(142,811,	 4, 3,  -350, 150,  0,		  0,   100, 0,";")
	}


	if ( !F2163 )
	{
		set_chr( 43,802,	 7, 5,    50,  50,  0,		  2,   240, 0,"I_$$$1 SF2163 V4_143;")	//④壷
		set_chr(143,811,	 7, 5,    50,  50,  0,		 -1,   240, 0,";")
	}
	else
	{
		set_chr(143,811,	 7, 5,   -50, -50,  0,		  0,   240, 0,";")
	}

//■宝箱

	if ( !Fx_622Bomb1 )
		set_chr( WOODBOX_CH,562,	1, 6,   365,-450,  0,		 2,    30,20,"<TK_WOODBOX_X> <EV_SetGetBomb1>;")	//①木箱
	else
		set_chr( WOODBOX_CH,562,	1, 6,   365,-450,  0,		 7,    30, 0,";")	//①木箱



	if(IT_TAKARA<1)
		set_chr( TAKARA_CH,560,	    9, 2,     0,   0,  0,		 6,     0,20,"<TK_TAKARA>;")		//②宝箱（並）
	else
		set_chr( TAKARA_CH,560,     9, 2,     0,   0,  0,		 7,     0, 0,";")		//②宝箱（並）




//■罠・障害物
	if ( !F2131 )
	{
		set_chr( 66,642,	 4, 3,   200, 200,  0,		  2,     0, 0,"I_$$$2 SF2131;")	//⑤岩
	}


	if ( !F2132 )
	{
		set_chr( 69 641,	 3, 4,  -400, 250,  0,		  5,     0, 0,"#0_78;")	//⑥パラボラアンテナ
		set_chr(169,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F67 I_$$$2 SF2132;");
	}


	if ( !F2130 )
		set_chr(110,630,	10, 5,     0,   0,  0,		  2,     0, 0,"I_FFF1 SF2130;")	//⑦樽
	else
		set_chr(110,630,	10, 5,     0,   0,  0,		  2,     0, 0,"I_$$$1;")	//⑦樽



	set_chr( 67,991,	 1, 6,  -700,   0,  0,		  0,070105, 0,";")	// 柵小
		color2( 67, 41,81,100, 0,0,0)

	set_chr( 68,669,	 1, 6,  -700,   0,  0,		  3,   270, 0,";") 		//⑧扇風機
		chr_equip_chr(68,67,"TG1",  200,  0,0,270,	   -150,0,0);


//■敵

	set_chr(  5,291,	 1, 6,     0,   0,150,		  2,     0, 0,";")		// ①敵 こぼるてす＆桶 
		chr_equip2(  5,	"eq_163",	"Bone_Spine",	100,		90, 0, 0,	0,-60,0);	// 桶
		color( 5,-1)		// 透明に
		F_set_chr( 5,CF_NO_MINIMAP)	// ミニマップ非表示
		F_set_chr( 5,CF_NO_HPBAR)	// HPバー非表示
		F_set_chr( 5,CF_NO_CLIP2)
		F_set_chr( 5,CF_NO_CSP)


	set_chr(  8,231,	 3, 7,    50,  50,  0,		  2,   270, 0,";") 	//②敵 こどもいえてぃ
	set_chr( 11,273,	 3, 5,   900,   0,  0,		  2,     0, 0,";")	//③敵 やまつつき

	set_chr( 13,144,	 3, 4,   700,-225,  0,		 -2,    90, 0,";")	//④敵a くまこぷたー
	set_chr( 14,144,	 3, 4,   700, 275,  0,		 -2,    90, 0,";")	//④敵b くまこぷたー

	set_chr( 15,274,	 4, 3,   900, -50,  0,		  2,   270, 0,";") 	//⑤敵 ゆきおこじょ
	set_chr( 16,231,	 5, 2,  -200,   0,  0,		  2,   180, 0,";")	//⑥敵a こどもいえてぃ
	set_chr( 17,231,	 5, 2,     0, 200,  0,		  2,   180, 0,";")	//⑥敵b こどもいえてぃ
	set_chr( 18,111,	 6, 3,     0,-450,  0,		  2,   180, 0,";")	//⑦敵a すざく
	set_chr( 19,111,	 6, 3,     0,-150,  0,		  2,   180, 0,";")	//⑦敵b すざく
	set_chr( 20,213,	 8, 3,     0, 275,  0,		 -2,   270, 0,";")	//⑧敵 おとないえてぃ

//■イベント
	set_chr(160,990,	 2, 6,   900,   0,-50,		  0,018604, 7,"x9_98")	// 川-横→
	set_chr(161,990,	 5, 6,     0,-700,-50,		  0,010418, 7,"y9_98")	// 川-縦↑
	set_chr(162,990,	 5, 5,   700,   0,-50,		  0,011804, 7,"x9_98")	// 川-横→
	set_chr(163,990,	 6, 5,     0, 700,-50,		  0,010418, 7,"y1_98")	// 川-縦↓
	set_chr(164,990,	 6, 6,   700,   0,-50,		  0,011804, 7,"x9_98")	// 川-横→
	set_chr(165,990,	 7, 6,   150,-700,-50,		  0,010718, 7,"y9_98")	// 川-縦↑
	set_chr(166,990,	 7, 5,  1500,   0,-50,		  0,013404, 7,"x9_98")	// 川-横→

	set_chr( 80,990,	 4, 5,     0, 850,  0,		  0,070603, 6,"SF100 #0_81 <EV_KoboGirlAppear>;")	// 川流れ開始
	set_chr( 81,990,	 4, 7,     0,-850,  0,		  0,070603, 6,"SF100 #0_80 <EV_KoboGirlAppear>;")	// 川流れ開始
	set_chr( 82,990,	 1, 6,   800,   0,  0,		  0,     0, 8,"F100 WT?30 Lj?0500 [0520や～ん]WT?45[0503];")		// 風②の原点
	set_chr( 83,990,	 2, 6,   700,   0,  0,		  0,     0, 0,";")	// 風③の原点

	set_chr( 73,990,	 3, 6,   700,   0,  0,		  0,     0, 8,"M8!51 WT?05 <EV_WakeUpFather>;")//④扉が開くとお父さん起きる		// 風④の原点
	if ( !F2103 )
	{
		set_chr( 75,990,	 5, 6,     0,   0,  0,		  0,     0, 8,"L4?0552 SF2103 O1_18 WT?10 C0_52 WT?20 M4_52 WT?30 C0_0;")//⑤扉を開く	// 風⑥の原点
	}
	else
	{
		set_chr( 75,990,	 5, 6,     0,   0,  0,		  0,     0, 3,";")//⑤扉を開く	// 風⑥の原点
		MOT( 52, 6, 0)
		EV("EV_KoboGirlAppear");
		chr_pos(  5,	16640,4856,0, 180, -1);
	}
	set_chr( 78,990,	 3, 4,  -200,  50,  0,		  0,071010, 6,"<EV_WakeUpAirForce>;")	// ④敵エリア パラボラアンテナ破壊で無効化 


	set_chr(147,990,	 9, 5,  -900,   0,  0,		  0,     0, 8,"L5?0599 <EV_KoboGirlSaved>;")	// 終点に近づいたら

	set_chr(130,990,	 5, 5,     0,   0,  0,		  0,     0, 0,";")	// 風⑦の原点
	set_chr(131,990,	 6, 5,     0,   0,  0,		  0,     0, 0,";")	// 風⑧の原点
	set_chr(132,990,	 6, 6,     0,   0,  0,		  0,     0, 0,";")	// 風⑨の原点
	set_chr(133,990,	 7, 6,   200,   0,  0,		  0,     0, 0,";")	// 風⑩の原点
	set_chr(134,990,	 7, 5,     0,   0,  0,		  0,     0, 0,";")	// 風⑪の原点
	set_chr(135,990,	 8, 5,     0,   0,  0,		  0,     0, 0,";")	// 風⑫の原点

//■場面固有設定

	EV("EV_KoboGirlHeart")
	EV("EV_SnowFall")
	EV("EV_GenWind")
}

//-------------------------------------------------------------------
EV_SnowFall
{
	EFF_chr(4292, 0, 0,100, -1, "charbase0" )
	wait( 50 )
	loop
}

//--------------------------------------------------------------------
EV_KoboGirlAppear
{
	color( 5,30)		// 不透明に
	F_reset_chr( 5,	CF_NO_MINIMAP)	// ミニマップ表示
	F_reset_chr( 5,	CF_NO_HPBAR)	// HPバー表示
	F_reset_chr( 5,CF_NO_CSP)
}

//--------------------------------------------------------------------
EV_KoboGirlSaved
{
	F_set(106)
}

//--------------------------------------------------------------------
EV_MarutaFall
{
	// 宝箱落下
	jump(70, 3, 23,-1,-1,25,325)
	wait_move(70)
}

//--------------------------------------------------------------------
EV_JUMP2
{
	//	ch,typ	tim,xyz		高さ
	jump(PLAYER1,2,	27,	0,-1800,0,	500)
	jump(PLAYER2,2,	27,	0,-1800,0,	500)
	jump(PET,2,	27,	0,-1800,0,	500)
	wait_move( PLAYER1 )
}

//--------------------------------------------------------------------
EV_JUMP3
{
	//	ch,typ	tim,xyz		高さ
	jump(PLAYER1,2,	30,	-2100,0,0,	500)
	jump(PLAYER2,2,	30,	-2100,0,0,	500)
	jump(PET,2,	30,	-2100,0,0,	500)
	wait_move( PLAYER1 )
}

//--------------------------------------------------------------------
EV_WakeUpFather
{
	MOT(20, 96, 15)
}

//--------------------------------------------------------------------
EV_WakeUpAirForce
{
	MOT(13, 96, 15)
	MOT(14, 96, 15)
}

//--------------------------------------------------------------------
EV_HitMarutaYure
{
	CAM_quake("823746")
}

//--------------------------------------------------------------------
EV_KoboGirlHeart
{
	if(!F5) // 生存
	{
		if (F102)	// 流れ丸太停止
		{
			if (F106)	// 一度終りまで行った
			{
				EFF_chr(5170, 5, 0, 100, 0,"Bone_Head")
			}
		}
	}
	wait( 60 )
	loop
}

//--------------------------------------------------------------------
EV_SetGetBomb1
{
	F_set(Fx_622Bomb1)
}


//--------------------------------------------------------------------
EV_GenWind
{
	EFF_chr(21560, 67, 270, 100, 0,"TG1")// → ①
	EFF_chr(21560, 83, 270, 100, 0,"TG1")// → ③
	EFF_chr(21560, 74, 270, 100, 0,"TG1")// → ⑤
	EFF_chr(21560,130, 270, 100, 0,"TG1")// → ⑦
	EFF_chr(21560,132, 270, 100, 0,"TG1")// → ⑨
	EFF_chr(21560,134, 270, 100, 0,"TG1")// → ⑪
	wait( 15 )

	EFF_chr(21560, 82, 270, 100, 0,"TG1")// → ②
	EFF_chr(21560, 73, 270, 100, 0,"TG1")// → ④
	EFF_chr(21560, 75, 180, 100, 0,"TG1")// ↑ ⑥
	EFF_chr(21560,131,   0, 100, 0,"TG1")// ↓ ⑧
	EFF_chr(21570,133, 180, 100, 0,"TG1")// ↑ ⑩
	EFF_chr(21560,135, 270, 100, 0,"TG1")// → ⑫
	wait( 15 )

	loop
}


#EndScriptTable
//====================================================================

