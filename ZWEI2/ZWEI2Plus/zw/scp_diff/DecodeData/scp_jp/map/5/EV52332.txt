//====================================================================
//ステージトラップスクリプト
//[15033][城－地下③]
//====================================================================

#ScriptTable

//--------------------------------------------------------------------
//■グローバルフラグ・ルートフラグはev52312.txt参照

//■ローカルフラグ
// 100 ①敵が出現。①トゲ壁起動
// 101 ②トゲ壁 簡易スクリプト進行許可
// 103 ⑫敵エリア
// 105 メイドロボが歩いているかどうか
// 112 メイドロボが生きていて、主人公に近い
// 115

#TREASURE_CH	48
#Fx_TREASURE	2305	//☆005ファラオの棺	

//--------------------------------------------------------------------
INIT
{
//環境
	SE(66,0)

//■地形
	set_obj("obx0514",	 5, 5,   -50,   0,  0,	 0) //穴
	set_obj("obx0514",	 2, 5,     0,-300,  0,	 0) //穴

	set_obj("mp52162",	 1, 5,  -300,-900,  0,	 0) //釣牢ガイコツ入り
	set_obj("mp52162",	 1, 7,     0, 300,600,	 0) //釣牢ガイコツ入り

//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
//■階段・扉

	set_chr( 90,990,	 8, 8,     0,   0,  0,		180,  0201, 6,"K0_1;")		//①エントリ 地下②
	set_obj("@obx0042a", 8, 8,     0,   0,  0,		180)						//①階段上（地下）
	set_chr(190,1300,	 8, 8,	   0,   0,  0,		  0,   180, 0,";")			//階段下（ダミー）

	set_chr( 91,990,	 4, 5,  -100,   0,  0,		 90,  0102, 6,"K0_15039;")	//②エントリ 地下ボス
	set_obj("@obx0052a", 4, 5,     0,   0,  0,		 90)						//②階段下（地下）
	set_chr(109,622,	 4, 5,     0,   0,  0,		  0,    90, 0,";")			//②ゴール用天使
	set_chr(191,1400,	 4, 5,	   0,   0,  0,		  0,    90, 0,";")			//アーチ（ダミー）

	set_chr( 50,505,	 7, 5,  -900,   0,  0,		  7,   270, 0,";")	//③扉（地下）閉鎖
	set_chr( 51,505,	 7, 4,  -900,   0,  0,		  7,   270, 0,";")	//④扉（地下）閉鎖
	set_chr( 52,505,	 6, 3,     0,-900,  0,		  7,     0, 0,";")	//⑤扉（地下）閉鎖
	set_chr( 53,505,	 5, 3,     0,-900,  0,		  7,     0, 0,";")	//⑥扉（地下）閉鎖
	set_chr( 54,505,	 4, 3,     0,-900,  0,		  7,     0, 0,";")	//⑦扉（地下）閉鎖

	set_chr( 55,505,	 7, 7,     0,-900,  0,		  8,   180, 6,";")	//⑧扉（地下）一通

	set_chr( 56,505,	 7, 6,     0,-900,  0,		  3,   180, 6,";")	//⑨扉（地下）自由
	set_chr( 57,505,	 7, 5,     0,-900,  0,		  3,   180, 6,";")	//⑩扉（地下）自由
	set_chr( 58,505,	 7, 4,     0,-900,  0,		  3,   180, 6,";")	//⑪扉（地下）自由
	set_chr( 59,505,	 7, 3,  -900,   0,  0,		  3,    90, 6,";")	//⑫扉（地下）自由
	set_chr( 60,505,	 6, 3,  -900,   0,  0,		  3,    90, 6,";")	//⑬扉（地下）自由
	set_chr( 61,505,	 5, 3,  -900,   0,  0,		  3,    90, 6,";")	//⑭扉（地下）自由
	set_chr( 62,505,	 4, 3,  -900,   0,  0,		  3,    90, 6,";")	//⑮扉（地下）自由

	set_chr( 63,505,	 2, 4,     0, 900,  0,		  6,     0, 0,";")	//⑱扉（地下）開放
	set_chr( 64,505,	 2, 4,     0, 900,  0,		  6,     0, 0,";")	//⑲扉（地下）開放

	set_chr( 92,990,	 5, 5,   -50,   0,  0,		 90,070804, 6,"k8_0 F115 RF115 <EV_ConfigureMainFloor>")
	set_chr( 93,990,	 2, 5,     0,-300,-50,		 90,070408, 6,"k9_0 F115 RF115 <EV_ConfigureMainFloor>")

	set_chr( 94,672,	 5, 8,     0,   0,  0,		  0,   270, 6,"K6_3")		//⑯ジャンプ台
	set_chr( 95,672,	 2, 7,     0,   0,  0,		  0,   180, 6,"K7_3")		//⑰ジャンプ台

	set_chr(150,990,	 5, 8,     0,   0,  0,		270,070804, 6,"    !F115 SF115 <EV_ConfigureSubFloor>")	// 洞窟エリア
	set_chr(151,990,	 2, 7,     0,   0,  0,		180,070408, 6,"    !F115 SF115 <EV_ConfigureSubFloor>")	// 洞窟エリア


	set_chr( 96,990,	 5, 5,     0, -50,600,		 90,     0, 0,";")		//帰路専用
	set_chr( 97,990,	 2, 5,     0,-300,600,		  0,     0, 0,";")		//帰路専用
	set_chr( 98,990,	 5, 8,     0,   0,  0,		 90,     0, 0,";")		//往路専用
	set_chr( 99,990,	 2, 7,     0,   0,  0,		  0,     0, 0,";")		//往路専用

//■スイッチ・看板
	set_chr( 65,804,	 7, 5,  -750,-175,  0,		  0,   270, 8,"(L2?99 [9991禁固５年\n罪状＿峠荒らし] WT?20 L2!99 [9903] WT?30);")		//③看板
	set_chr( 66,804,	 7, 4,  -750,-175,  0,		  0,   270, 8,"(L2?99 [9991禁固１０年\n罪状＿オーバークロック熱暴走] WT?20 L2!99 [9903] WT?30);")	//④看板
	set_chr( 67,804,	 6, 3,  -175,-750,  0,		  0,     0, 8,"(L2?99 [9991禁固５０年\n罪状＿気まぐれ処刑] WT?20 L2!99 [9903] WT?30);")	//⑤看板
	set_chr( 68,804,	 5, 3,  -175,-750,  0,		  0,     0, 8,"(L2?99 [9991禁固１００年\n罪状＿発火体質] WT?20 L2!99 [9903] WT?30);")	//⑥看板
	set_chr( 69,804,	 4, 3,  -175,-750,  0,		  0,     0, 8,"(L2?99 [9991禁固５００年\n罪状＿ちょいワルヒーロー] WT?20 L2!99 [9903] WT?30);")		//⑦看板
//	set_chr( 70,804,	 2, 5,  -175,-750,  0,		  0,     0, 8,"(L2?99 [9991自宅謹慎１０００年\n罪状＿無職] WT?20 L2!99 [9903] WT?30);")	//⑧看板

	set_chr( 71,665,	 7, 7,  -400,   0,  0,		  6,     0, 0,";")		//⑨ゴング ①敵

//■宝箱
	set_chr( 49,626,	 3, 5,   450,   0,  0,		  0,   270,10,"!F2960 I_SLOT SF2960 <EV_SlotDarken>;")	//①スロットマシン
	if ( F2960 )
	{
		MOT( 49, 3, 1);
		EV("EV_SlotDarken")
	}

	if( !Fx_TREASURE )
		set_chr( TREASURE_CH,561,	 2, 4,  -125,-250,  0,     6,     0,20,"<TK_TREASURE>;")
	else
		set_chr( TREASURE_CH,561,	 2, 4,  -125,-250,  0,     7,     0, 0,";")

	if ( !F2130 )
	{
		set_chr( 47,561,		 6, 3,     0, 350,  0,		  2,   180, 5,"V4_8 D1_99;")	//②宝箱（上）ミミック
		set_chr(  8,230,		 6, 3,     0, 350,  0,		 -1,   180, 0,"SF2130;")		//②敵 みみっく
	}

//■罠・障害物
	set_chr( 78,701,	 2, 4,     0,-250,  0,		  0,   290, 0,";")			//①ガイコツ
	set_chr( 79,629,	 8, 7,   300,   0,  0,		  0,    90, 0,"X1_-150 WT?60 X1_-150 WT?60 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 M2_99 F2108 M4_99 X1_1925 M2_99;")//②トゲ壁
	
//	set_chr( 79,629,	 8, 7,   300,   0,  0,		  0,    90, 8,"F101 M3_99 X1_-300 M2_99 WT?120 WT?60  M3_99 X1_-300 M2_99 WT?120  M3_99 X1_-300 M2_99 WT?120  M3_99 X1_-300 M2_99 WT?120  M3_99 X1_-300 M2_99 WT?120  M3_99 X1_-300 M2_99 WT?120  F2108 M4_99 X1_1925 M2_99;")//②トゲ壁
//	set_chr( 79,629,	 8, 7,   300,   0,  0,		  0,    90, 8,"F101 M3_99 X1_-150 WT?60 X1_-150 WT?60 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 X1_-150 WT?60 M2_99 F2108 X1_1925;")//②トゲ壁
//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++

	if ( !F2195 )
	{
		set_chr( 73,641,	 5, 3,     0, 350,  0,		  2,   180, 0,";")	//⑥パラボラアンテナ
		set_chr(173,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F73 I_$$$2 SF2195;");
	}

	if ( !F2196 )
	{
		set_chr( 74,641,	 4, 3,     0, 350,  0,		  2,   180, 0,";")	//⑦パラボラアンテナ
		set_chr(174,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F74 I_$$$2 SF2196;");
	}


	set_chr(115,669,	 6, 4,  -350, 350,  0,		  3,   225, 0,";")	//⑧扇風機

	set_chr( 77,701,	 8, 7,   450,-450,  0,		  0,     0, 8,"(L2?99 [9991『ここにはさまって骨になりました。\n転位術が使えればなぁ……』] WT?20 L2!99 [9903] WT?30);")	//④看板

//■ハニワ・壷
	if ( !F2170 )
	{
		set_chr( 40,802,	 7, 5,   300,-300,  0,		  2,   225, 0,"I_$$$1 SF2170 V4_140;")	//①壷
		set_chr(140,811,	 7, 5,   300,-300,  0,		 -1,   225, 0,";")
	}
	else
	{
		set_chr(140,811,	 7, 5,   300,-300,  0,		  0,   225, 0,";")
	}


	if ( !F2171 )
	{
		set_chr( 41,802,	 6, 4,   300,-300,  0,		  2,   180, 0,"I_$$$1 SF2171 V4_141;")	//②壷
		set_chr(141,811,	 6, 4,   300,-300,  0,		 -1,   180, 0,";")
	}
	else
	{
		set_chr(141,811,	 6, 4,   300,-300,  0,		  0,   180, 0,";")
	}


	if ( !F2172 )
	{
		set_chr( 42,634,	 6, 3,   400, 400,  0,		  2,     0, 0,"I_US01 SF2172 V4_142;")	//③ハニワ
		set_chr(142,812,	 6, 3,   400, 400,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(142,812,	 6, 3,   400, 400,  0,		  0,     0, 0,";")
	}


	if ( !F2173 )
	{
		set_chr( 43,802,	 4, 2,     0,-350,  0,		  2,    90, 0,"I_$$$1 SF2173 V4_143;")	//④壷
		set_chr(143,811,	 4, 2,     0,-350,  0,		 -1,    90, 0,";")
	}
	else
	{
		set_chr(143,811,	 4, 2,     0,-350,  0,		  0,    90, 0,";")
	}

//■敵
	// 入口部屋
	set_chr(  1,138,	 8, 7,  -500,   0,500,		 -1,    90, 8,"F100 WT?05 V1_99;") //①敵a パニッシャー
	set_chr(  2,266,	 8, 7,  -200,-250,500,		 -1,    90, 8,"F100 WT?10 V1_99;") //①敵a 青トカゲ②
	set_chr(  3,266,	 8, 7,  -200, 250,500,		 -1,    90, 8,"F100 WT?15 V1_99;") //①敵b 青トカゲ②
	set_chr(  4,266,	 8, 7,  -800,-250,500,		 -1,    90, 8,"F100 WT?20 V1_99;") //①敵b 青トカゲ②
	set_chr(  5,266,	 8, 7,  -800, 250,500,		 -1,    90, 8,"F100 WT?25 V1_99;") //①敵b 青トカゲ②

	// 囚人1
//	if ( !F2131 )
	{
		set_chr( 10,128,	 6, 5,     0,   0,  0,		  2,   270, 0,"SF2131;") //③敵 ちゃりおっと	標準Lv12 + 追加Lv0 = 12
	}
//	if ( !F2132 )
	{
		set_chr( 11,255,	 6, 5,     0,   0,  0,		  2,   270, 0,"SF2132;") //③敵 もりこぼると	標準Lv9 + 追加Lv3 = 12
	}
//	if ( !F2131 )
	{
//		if ( !F2132 )
		{
			chr_equip_chr(11,10,"Null_Mon", 100,	0,  0,180,	0,0, 0);
			chr_state_LV(10, 3);
			chr_state_LV(11, 3);
			set_chr(139,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F11 (!F10 M4_10 WT?15);") // ③敵 ちゃりおっと後始末
		}
	}

	// 囚人2
//	if ( !F2133 )
	{
		set_chr( 12,290,	 6, 4,     0,   0,  0,		  2,   270, 0,"SF2133;") //④敵 ばんのうめいど	標準Lv14

		set_chr( 87,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"RF105 M0?12 SF105")	// メイドロボが歩いているかどうか
		set_chr( 88,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"RF112 !F12 Lf?1200 SF112")	// メイドロボが生きていて、主人公に近い
		EV("EV_MaidSmoke")	//メイド煙
	}

	// 囚人3
//	if ( !F2134 )
	{
		set_chr( 14,138,	 6, 2,     0,   0,  0,		  2,     0, 0,"SF2134;") //⑤敵 ぱにっしゃー		標準Lv13 + 追加Lv1 = 14
			chr_state_LV(14, 1);
	}

	// 囚人4
//	if ( !F2135 )
	{
		set_chr( 16,212,	 5, 2,     0,   0,  0,		  2,     0, 0,"SF2135;") //⑥敵 いふりーと	標準Lv13 + 追加Lv1 = 14
			chr_state_LV(16, 1);
	}

	// 囚人5
//	if ( !F2136 )
	{
		set_chr( 18,228,	 4, 2,     0,   0,  0,		  2,     0, 0,"SF2136;") //⑦敵 こぼるたん	標準Lv15 + 追加Lv1 = 15
			chr_state_LV(18, 1);
	}

	// 看守側
	set_chr( 20,265,	 7, 5,   300, 350,  0,		  2,   180, 0,";") //⑧敵 メタジェリー
	set_chr( 21,140,	 7, 3,  -300,   0,  0,		  2,    45, 0,";") //⑨敵a ジゴクグルマ
	set_chr( 22,140,	 7, 3,     0, 350,  0,		  2,   135, 0,";") //⑨敵b ジゴクグルマ
	set_chr( 23,266,	 5, 3,   350, 300,  0,		  2,   270, 0,";") //⑩敵 青トカゲ②
	set_chr( 24,265,	 4, 3,  -350, 300,  0,		  2,     0, 0,";") //⑪敵 メタジェリー



	set_chr( 30,263,	 3, 8,  -900,  50,400,		 -1,   240, 8,"F103 WT?45 V1_99;") //⑫敵a ですくろうらー
	set_chr( 31,264,	 3, 8,  -600, -50,400,		 -1,   300, 8,"F103 WT?35 V1_99;") //⑫敵b キャタピラー
	set_chr( 32,264,	 3, 8,  -300,  50,400,		 -1,   240, 8,"F103 WT?25 V1_99;") //⑫敵b キャタピラー
	set_chr( 33,264,	 3, 8,     0, -50,400,		 -1,   300, 8,"F103 WT?15 V1_99;") //⑫敵b キャタピラー
	set_chr( 34,263,	 3, 8,   300,   0,400,		 -1,   270, 8,"F103 WT?05 V1_99;") //⑫敵a ですくろうらー
	set_chr( 35,263,	 4, 8,  -450,   0,400,		 -1,    90, 8,"F103 WT?05 V1_99;") //⑫敵a ですくろうらー
	set_chr( 36,264,	 4, 8,  -150,  50,400,		 -1,    60, 8,"F103 WT?15 V1_99;") //⑫敵b キャタピラー
	set_chr( 37,264,	 4, 8,   150, -50,400,		 -1,   120, 8,"F103 WT?25 V1_99;") //⑫敵b キャタピラー
	set_chr( 38,264,	 4, 8,   450,  50,400,		 -1,    60, 8,"F103 WT?35 V1_99;") //⑫敵b キャタピラー
	set_chr( 39,263,	 4, 8,   750, -50,400,		 -1,   120, 8,"F103 WT?45 V1_99;") //⑫敵a ですくろうらー


//■イベント
	set_chr( 80,990,	 3, 8,   900,   0,  0,		  0,  0205, 6,"SF103;")// ⑫敵エリア

	set_chr( 84,990,	 8, 7,  -200,   0,  0,		  0,     0, 8,"M2!71 WT?20 SF100 <EV_SpikeWallMove> C0_84 F101 M3_79 #8_79 C0_0;")// ②コング
	if ( !F2108 )
	{
//		set_chr( 85,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F1             WT?10 O1_18 WT?20 #3_79 C0_55 WT?20 M4_55 WT?20 C0_50 WT?20 M4_50 WT?20 C0_66 WT?20 M4_51 WT?30 C0_0 SF2108 <EV_PrisonersEscape> #8_79;")// ①敵戦闘終了
		set_chr( 85,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F1 F2 F3 F4 F5 WT?10 O1_18 WT?20 #3_79 C0_55 WT?20 M4_55 WT?20 C0_50 WT?20 M4_50 WT?20 C0_66 WT?20 M4_51 WT?30 C0_0 SF2108 <EV_PrisonersEscape> #8_79;")// ①敵戦闘終了
		// ↑メイドロボの牢はわざと66看板にカメラを移してる。扉に移すと背景に動きが出ないので。
//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
	}
	else
	{
		MOT( 55, 6, 0)
		MOT( 50, 6, 0)
		MOT( 51, 6, 0)
		EV("EV_PrisonersEscape")
	}
}

//--------------------------------------------------------------------
EV_MaidSmoke
{
	if(F112)
	{
		EFF_chr(5150, 12, 0, 100, 0,"Bone_Head")
	}
	if(F105)
	{
		wait( 2 )
	}
	else
	{
		wait( 10 )
	}

	loop
}

//--------------------------------------------------------------------
EV_SpikeWallMove
{
	wait( 30 )
	jump( 79, 2, 30, -150,0,0,  0)
	wait_move( 79 )
	F_set(101)
}

//--------------------------------------------------------------------
EV_PrisonersEscape
{
	MOT(50, 4, 0)
	MOT(51, 4, 0)
	MOT(52, 4, 0)
	MOT(53, 4, 0)
	MOT(54, 4, 0)

	// ジャンプで代用
	jump(10,2,60, 1200,0,0,	300)
	jump(12,2,60, 1500,0,0,	300)
	jump(14,2,60, 0,-1700,0, 300)
	jump(16,2,60, 0,-1800,0, 300)
	jump(18,2,60, 0,-1800,0, 300)
	F_set_chr(10,CF_NO_CLIP2)
	F_set_chr(12,CF_NO_CLIP2)
	F_set_chr(14,CF_NO_CLIP2)
	F_set_chr(16,CF_NO_CLIP2)
	F_set_chr(18,CF_NO_CLIP2)
}

//--------------------------------------------------------------------
EV_ConfigureSubFloor
{
	MOT(0, 2, 0)
}

//--------------------------------------------------------------------
EV_ConfigureMainFloor
{
}

//--------------------------------------------------------------------
EV_SlotDarken
{
	wait(15)
	color2( 49, 70,70,70,,0,0,0)		// スロット暗く
}

#EndScriptTable
//====================================================================
