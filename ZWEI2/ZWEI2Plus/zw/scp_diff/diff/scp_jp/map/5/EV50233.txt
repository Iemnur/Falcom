//====================================================================
//ステージトラップスクリプト
//[15023][城－城内③]
//====================================================================

#ScriptTable

//--------------------------------------------------------------------
//■グローバルフラグ・ルートフラグはev50213.txt参照

//■ローカルフラグ
// x102 ①ボタンスイッチを押した
// 103 樽落下
// 104 ⑦敵が出現
// 105 ⑦敵の戦闘２段目
// 106 ⑦敵の戦闘３段目
// 107 ⑦敵の戦闘終了

#TREASURE_CH	48
#Fx_TREASURE	2327	//☆027雷竜の後足

#TREASURE2_CH	48
#Fx_TREASURE2	2335	//☆035剣竜の後足

#WOODBOX_CH		47
#IT_WOODBOX		197		//∴197栗ようかん

//--------------------------------------------------------------------
INIT
{
//■地形
	set_obj2("mp50023",  6, 7, -450,-450,  0,	 0) //
	set_obj2("mp50033",  6, 7,  450,-450,  0,	 0) //
	set_obj("mp50183",   6, 7, -450, 900,  0,	 0) //

	set_obj2("mp50003",  5, 2, -450, 450,  0,	 0) //
	set_obj2("mp50013",  5, 2,  450, 450,  0,	 0) //
	set_obj("mp50183",   5, 1, -450,1350,  0,	 0) //

//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
//■階段・扉

	set_chr( 90,990,	 5, 4,  -850,   0,  0,		 90,  0102, 6,"K0_1;")		//①エントリ 城内②
	set_obj("@ob50523a", 5, 4,  -750,   0,  0,		 90)						//①階段下（城内）
	set_chr(190,1300,	 5, 4,  -750,   0,  0,		  0,    90, 0,";")			//階段下（ダミー）

	set_chr( 91,990,	 7, 5,     0,   0,  0,		  0,  0201, 6,"K0_15029;")	//②エントリ 城内終
	set_obj("@ob50513a", 7, 5,     0,   0,  0,		  0)						//②階段上（城内）
	set_chr(109,622,	 7, 5,     0,   0,  0,		  0,     0, 0,";")			//②ゴール用天使
	set_chr(191,1400,	 7, 5,	   0,   0,  0,		  0,     0, 0,";")			//アーチ（ダミー）

	set_chr( 50,1220,	 6, 5,  -900,   0,  0,		  7,    90, 0,";") //③扉（城内）閉鎖
	set_chr( 52,503,	 3, 6,     0,-900,  0,		  3,   180, 6,";") //④扉（城内）自由
	set_chr( 53,503,	 3, 6,   900,   0,  0,		  3,   270, 6,";") //⑤扉（城内）自由
	set_chr( 55,503,	 6, 6,  -900,   0,  0,		  7,   270, 0,";") //⑦扉（城内）閉鎖
	set_chr( 56,503,	 6, 6,   900,   0,  0,		  8,   270, 6,";") //⑧扉（城内）一通

//■スイッチ・看板

	if ( !F2108 )
	{
	// 初回
		set_chr( 57,570,	 3, 6,  -250, 250,  0,		  6,     0, 5,"M6?99 M5_99 SF2108")	//①ボタンスイッチ
	}
	else
	{
	// 押され
		set_chr( 57,570,	 3, 6,  -250, 250,  0,		  7,     0, 3,";")	//①ボタンスイッチ
	}

	set_chr( 58,665,	 6, 6,     0, 900,  0,		  2,     0, 8,"M3?99 SF104;")		//②ゴング ⑦敵
	set_chr( 59,655,	 3, 5,  -125,-900,  0,		  4,   270, 0,";")	//③順路案内

	set_chr( 60,657,	 7, 5, -1000,   0,  0,		  0,   270, 0,";")	//②ハテナ看板
	set_chr( 61,804,	 7, 5, -1000,   0,115,		  0,   270, 8,"(L2?99 [9991宝箱より前に取れるものがある。] WT?20 L2!99 [9903] WT?30);")	//②看板


//■ハニワ・壷
	if ( !F2170 )
	{
		set_chr( 40,802,	 5, 4,  -250,   0,  0,		  2,   180, 0,"I_$$$1 SF2170 V4_140;")	//①壷
		set_chr(140,811,	 5, 4,  -250,   0,  0,		 -1,   180, 0,";")
	}
	else
	{
		set_chr(140,811,	 5, 4,  -250,   0,  0,		  0,   180, 0,"I_$$$1;")
	}


	if ( !F2171 )
	{
		set_chr( 41,802,	 5, 3,   900, 150,  0,		  2,     0, 0,"I_$$$1 SF2171 V4_141;")	//②壷
		set_chr(141,811,	 5, 3,   900, 150,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(141,811,	 5, 3,   900, 150,  0,		  0,     0, 0,"I_$$$1;")
	}
	// ②壷は下のほうで

	if ( !F2172 )
	{
		set_chr( 42,802,	 6, 5,     0, 250,  0,		  2,    45, 0,"I_$$$1 SF2172 V4_142;")	//③壷
		set_chr(142,811,	 6, 5,     0, 250,  0,		 -1,    45, 0,";")
	}
	else
	{
		set_chr(142,811,	 6, 5,     0, 250,  0,		  0,    45, 0,"I_$$$1;")
	}


	if ( !F2173 )
	{
		set_chr( 43,802,	 3, 6,  -250, 250, 37,		  2,   120, 0,"I_$$$1 SF2173 V4_143;")	//④壷
		set_chr(143,811,	 3, 6,  -250, 250, 37,		 -1,   120, 0,";")
		chr_equip_chr( 43, 57,"switch02",  100,   0,0,0,	0,0,37);
		chr_equip_chr(143, 57,"switch02",  100,   0,0,0,	0,0,37);
	}
	else
	{
		set_chr(143,811,	 3, 6,  -250, 250, 37,		  0,   120, 0,"I_$$$1;")
		chr_equip_chr(143, 57,"switch02",  100,   0,0,0,	0,0,37);
	}


	if ( !F2174 )
	{
		set_chr( 44,802,	 7, 6,   150, 150,  0,		  2,   290, 0,"I_$$$1 SF2174 V4_144;")	//⑤壷
		set_chr(144,811,	 7, 6,   150, 150,  0,		 -1,   290, 0,";")
	}
	else
	{
		set_chr(144,811,	 7, 6,   150, 150,  0,		  0,   290, 0,"I_$$$1;")
	}


//■宝箱
	set_chr( 49,626,	 7, 6,     0,-250,  0,		  0,     0,10,"!F2958 I_SLOT SF2958 <EV_SlotDarken>;")	//①スロットマシン
	if ( F2958 )
	{
		MOT( 49, 3, 1);
		EV("EV_SlotDarken")
	}

	// ②宝箱
	if ( GW_LV_PLATE==0 )
	{
		if( !Fx_TREASURE )
			set_chr( TREASURE_CH,561,	 5, 5,     0,   0,  0,  	 6,   270,20,"<TK_TREASURE>;")
		else
			set_chr( TREASURE_CH,561,	 5, 5,     0,   0,  0,  	 7,   270, 0,";")
	}
	else
	{
		if( !Fx_TREASURE2 )
			set_chr( TREASURE2_CH,561,	 5, 5,     0,   0,  0,  	 6,   270,20,"<TK_TREASURE2>;")
		else
			set_chr( TREASURE2_CH,561,	 5, 5,     0,   0,  0,  	 7,   270, 0,";")
	}

	if ( !Fx_523Food1 )
		set_chr( WOODBOX_CH,562,	5, 3,     0,-850,  0,		  6,     0,20,"<TK_WOODBOX><EV_SetGetFood1>;")	//③木箱
	else
		set_chr( WOODBOX_CH,562,	5, 3,     0,-850,  0,		  7,     0, 0,";")	//③木箱


//■罠・障害物
	set_chr(110,698,	 4, 5,   150,-900,  0,		  0 ,    0, 0,";")	//柵中
	color2(110, 100,63,100, 0,0,0)	// 城内の柵の色

	set_chr(111,627,	 6, 6,     0,-900,  0,		  0,     0, 0,";")	//柵小
	color2(111, 100,63,100, 0,0,0)	// 城内の柵の色

	set_chr(112,627,	 6, 5,   600,   0,  0,		  0,    90, 0,";")	//柵小
	color2(112, 100,63,100, 0,0,0)	// 城内の柵の色

	if ( !F2190 )
		set_chr( 73,631,	 3, 6,   500,   0,600,		 -1,     0, 0,"I_BBB1 I_BBB1 I_BBB1 SF2190;") //①爆弾タル
	else
		set_chr( 73,631,	 3, 6,   500,   0,600,		 -1,     0, 0,"I_BBB1 I_BBB1 I_BBB1;") //①爆弾タル


	if ( !F2140 )
	{
		set_chr( 74,632,	 4, 4,   250,   0,  0,		  2,    90, 0,"I_$$$1 SF2140;") //②バリケード
	}

	if ( !F2141 )
	{
		set_chr( 75,632,	 4, 6,   650,   0,  0,		  2,    90, 0,"I_$$$1 SF2141;") //③バリケード
	}


//■敵
	set_chr(  3,227,	 6, 4,     0,-900,  0,		  2,    90, 0,";") //①敵 こぼるとないと


	set_chr(  4,220,	 3, 4,   150, 150,  0,		  2,   270, 0,";") //②敵 でゅらはん
		set_chr(  5,260,	 3, 4,   150, 150,  0,		  2,   270, 0,";") //③敵 ぱさらん
			chr_equip2( 5,	"eq_104",	"Bone_Hips",	90,		0,0,0,	0,0,0);
		chr_equip_chr( 5, 4,"Bone_Head",   95,   90,0,0,	0,-5,0);
		chr_equip2(  4,	"eq_004",	"Bone_RightHand",	100,		45,60,-45,	 0,0,0);


	set_chr(  7,260,	 5, 3,  -900,   0,  0,		  2,   270, 0,";") //③敵 ぱさらん
		chr_equip2( 7,	"eq_104",	"Bone_Hips",	90,		0,0,0,	0,0,0);

	set_chr( 30,221,	 3, 6,   500,   0,700,		 -1,    90, 8,"F103 V1_99;") //④敵 でくぼっと

	set_chr( 10,220,	 4, 5,   150, 350,  0,		  2,   180, 0,";") //⑤敵a でゅらはん
		chr_equip2( 10,	"eq_150",	"Bone_LeftHand",	100,		-15,180,180,	 -15,30,-30);
		chr_equip2( 10,	"eq_006",	"Bone_RightHand",	100,		45,0,-45,	 0,0,0);

	set_chr( 11,227,	 4, 5,     0, 650,  0,		  2,   150, 0,";") //⑤敵b こぼるとないと
	set_chr( 12,227,	 4, 5,   300, 650,  0,		  2,   210, 0,";") //⑤敵c こぼるとないと

	set_chr( 14,220,	 5, 3,     0,   0,  0,		  3,     0, 0,";") //⑥敵 でゅらはん
		chr_equip2( 14,	"eq_151",	"Bone_LeftHand",	100,		0,180,180,	 -15,30,-30);
		chr_equip2( 14,	"eq_001",	"Bone_RightHand",	100,		45,60,-45,	 0,0,0);
		
//		if ( !F2171 )
//		{
//			set_chr( 41,802,	 3, 4,   150, 150,  0,		  2,     0, 0,"I_$$$1 SF2171 V4_141 <EV_AttachOff141>;")	//②壷
//			set_chr(141,811,	 3, 4,   150, 150,  0,		 -1,     0, 0,";")
//			chr_equip_chr( 41,14,"Bone_Head",  80, 91,0,0,	0,0,0);
//			chr_equip_chr(141,14,"Bone_Head",  80, 91,0,0,	0,0,0);
//		}

	set_chr( 16,227,	 6, 6,  -350,   0,500,		 -1,   315, 8,"F104 WT?10 V1_99;") //⑦敵1a こぼるとないと
	set_chr( 17,227,	 6, 6,   350,   0,500,		 -1,    45, 8,"F104 WT?15 V1_99;") //⑦敵1b こぼるとないと
	set_chr( 18,220,	 6, 6,   350,   0,  0,		 -1,   180, 8,"F104 WT?25 V1_99;") //⑦敵1c でゅらはん
		chr_equip2( 18,	"eq_151",	"Bone_Head",	97,		 0, 0,-20,	  -30,10,0);
		chr_equip2( 18,	"eq_150",	"Bone_Head",	97,		 0, 0, 20,	   30,10,0);
		chr_state_LV(18, 1);
	set_chr( 19,221,	 6, 6,  -350,   0,500,		 -1,    90, 8,"F104 V1_99;") //⑦敵1d でくぼっと

	set_chr( 20,260,	 6, 6,     0,-250,500,		 -1,   315, 8,"F105 WT?20 V1_99;") //⑦敵2a ぱさらん
		chr_equip2( 20,	"eq_104",	"Bone_Hips",	90,		0,0,0,	0,0,0);
	set_chr( 21,260,	 6, 6,     0,   0,500,		 -1,    45, 8,"F105 WT?25 V1_99;") //⑦敵2b ぱさらん
		chr_equip2( 21,	"eq_104",	"Bone_Hips",	90,		0,0,0,	0,0,0);
	set_chr( 22,309,	 6, 6,     0, 250,500,		 -1,    90, 8,"F105 V1_99;") //⑦敵2c おーがにくす

	set_chr( 23,228,	 6, 6,     0,   0,-150,		 -1,     0, 8,"F106 V1_99;") //⑦敵3a こぼるたん


//■イベント

	// ザコ連戦
	set_chr( 81,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F104 M5_55 M5_56 F16 F17 F18 F19 SF105 F20 F21 F22 SF106 F23 SF107;")//
	if(WK_ENTRY==91)//階段91 から来た時（帰り）
	{
		set_chr( 82,990, 0, 0,     0,   0,  0,		  0,     0, 8,"F107 WT?10 O1_18 WT?20 C0_55 WT?20 M4_55 M4_56 WT?30 C0_0;")//
	}
	else 
	{
		set_chr( 82,990, 0, 0,     0,   0,  0,		  0,     0, 8,"F107 WT?10 O1_18 WT?20 C0_56 WT?20 M4_55 M4_56 WT?30 C0_0;")//
	}


	if ( !F2108 )
	{
		if(WK_ENTRY==91)//階段91 から来た時（帰り）
		{
			set_chr( 83,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F2108 O1_18                        #8_84 WT?20 C0_30 WT?30 SF103 WT?40 D1_73 WT?10 C0_0;")//①ボタンスイッチで⑥扉を開く
			set_chr( 84,990,	 0, 0,     0,   0,  0,		  0,     0, 0,"<EV_FallBarrel1> WT?7 V3_73 M2_73;")//樽落下
		}
		else
		{
			set_chr( 83,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F2108 O1_18 WT?10 C0_55 WT?20 M4_55 #8_84 WT?20 C0_30 WT?30 SF103 WT?40 D1_73 WT?10 C0_0;")//①ボタンスイッチで⑥扉を開く
			set_chr( 84,990,	 0, 0,     0,   0,  0,		  0,     0, 0,"<EV_FallBarrel1> WT?7 V3_73 M2_73;")//樽落下
		}
	}
	else
	{
		set_chr( 84,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"M6_55 SF103 <EV_FallBarrel1> WT?7 V3_73 M2_73 ;")//樽落下
	}


	if ( !F2145 )
	{
		set_chr(158,990,	 6, 5,  -900,   0,  0,		  6,     0,	8,"L0!9950 WT?10 O1_18 SF2145;")
//		set_chr(158,990,	 0, 0,     0,   0,  0,		  6,     0,	8,"Z1?50 WT?10 O1_18 SF2145;")
	}

//■場面固有設定
	EV("EV_aaa")
	

}

//--------------------------------------------------------------------
EV_FallBarrel1
{
	jump(73,2,30, 0,0,-600,	600)
}

//--------------------------------------------------------------------
EV_SlotDarken
{
	wait(15)
	color2( 49, 70,70,70,,0,0,0)		// スロット暗く
}

//--------------------------------------------------------------------
EV_SetGetFood1
{
	F_set(Fx_523Food1)
}

//--------------------------------------------------------------------
EV_AttachOff141
{
	chr_equip_off(141)
	jump( 141,3, 24,-1,-1,0, 150)
}

//--------------------------------------------------------------------
EV_aaa
{
	rot(50, 30, 90)
	wait(1)
	loop
	
}


#EndScriptTable
//====================================================================

