//====================================================================
//ステージトラップスクリプト
//[16013][山－メイン③]
//====================================================================

#ScriptTable

//--------------------------------------------------------------------
//■グローバルフラグ・ルートフラグはev60111.txt参照

//■ルートフラグ 2096-2192

//■ローカルフラグ
// 100 中ボス警報
// 101 中ボス出現
//x 102 ①ボタンスイッチを押した
// 103 ②的移動許可
// 107 路線Aアニメon/off
// 108 路線Bアニメon/off
// 109 路線Cアニメon/off

#TREASURE_CH	48
#Fx_TREASURE	2323	//☆023皇帝ペンギン

//--------------------------------------------------------------------
INIT
{
//環境SE
	SE(51,0)

//■地形

	set_obj("obx0494",	 4, 5,    50, 1250,  0,  	90);		// 沼
	set_obj("obx0494",	 5, 5,   -50,  450,  0,  	90);		// 沼
	set_obj("obx0494",	 4, 5,  1300, 1700,  0,  	 0);		// 沼

//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
//■階段・扉
	set_chr( 90,990,	 9,10,   -50,   0,  0,		 90,  0102, 6,"K0_1;")		//①エントリ メイン②
	set_obj("@ob60011a", 9,10,   -50,   0,  0,		 90)						//①階段下（山）
	set_chr(190,1300,	 9,10,   -50,   0,  0,		  0,    90, 0,";")			//階段下（ダミー）

	set_chr( 91,990,	 4, 1,     0,-150,  0,		  0,0201,6,"K0_10400;")		//②エントリ 星降りの里（昼）
	set_obj("@ob60031a", 4, 1,     0,-150,  0,		  0)						//②アーチ（山）
	set_chr(109,622,	 4, 1,     0,-150,  0,		  0,     0, 0,";")			//②ゴール用天使
	set_chr(191,1400,	 4, 1,     0,-150,  0,		  0,     0, 0,";")			//アーチ（ダミー）

	set_chr( 50,508,	 5, 2,   900,   0,  0,		  3,270,	6,";")	//③扉（山）自由
	set_chr( 51,508,	 4, 2,     0,-900,  0,		  7,  0,	0,";")	//④扉（山）閉鎖

	set_chr( 53,508,	 5, 5,   500,   0,  0,		  6,270,	0,";")	//⑤扉（山）開放
	set_chr( 54,508,	 4, 5,     0,-500,  0,		  7,180,	0,";")	//⑥扉（山）閉鎖

//■スイッチ・看板
	// 的 
	set_chr( 56,666,	 3, 1,     0,   0,  0,		  2,270, 8,"F103 Y9_-2800 Ye_2800 WT?10 Y9_-3600 (WT?60 Y9_5400 WT?60 Y9_-5400);") //②的
	if ( !F2107 )
	{
		set_chr( 86,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"M3?56 O1_18 WT?10 C0_51 WT?20 M4_51 WT?30 C0_0 SF2107;");
	}
	else
	{
		MOT( 51, 6, 0)
	}


	set_chr( 57,804,	 5, 2,  -175,-450,  0,		  0,  0,	8,"(L2?99 [9991「山」には「川」。\n「岩」には…] WT?30 L2!99 [9903] WT?30);")	//③看板
	set_chr( 58,658,	 6, 4,  -175, 700,  0,		  0,270,	0,";")	//④中ボス看板


//■ハニワ・壷
	if ( !F2170 )
	{
		set_chr( 40,802,	 7, 8,  -400,   0,  0,		  0,  0,	0,"I_$$$1 SF2170;")	//①壷
	}
	
	// ②ハニワはカエル

	if ( !F2172 )
	{
		set_chr( 42,802,	 6, 5,     0,-900,  0,		  0, 90,	0,"I_$$$1 SF2172;")	//③壷
	}


//■宝箱
	set_chr( 49,626,	 4, 2,     0,   0,  0,		  0,270,10,"!F2974 I_SLOT SF2974 <EV_SlotDarken>;")	//①スロットマシン
	if ( F2974 )
	{
		MOT( 49, 3, 1);
		EV("EV_SlotDarken")
	}

	if( !Fx_TREASURE )
		set_chr( TREASURE_CH,561,	 4, 4,     0,   0,  0,     6,     0,20,"<TK_TREASURE>;")
	else
		set_chr( TREASURE_CH,561,	 4, 4,     0,   0,  0,     7,     0, 0,";")




//■罠・障害物
	set_chr(110,673,	 8, 9,  -600,-650,  0,		  2,   180, 0,";")//リフト端[路線A]
	set_chr(111,673,	 8, 6,  -600,-150,  0,		  2,     0, 0,";")//リフト端[路線A]

	set_chr(112,673,	 7, 8,   150,-900,  0,		  2,   180, 0,";")//リフト端[路線B]
	set_chr(113,673,	 7, 5,   150, 150,  0,		  2,     0, 0,";")//リフト端[路線B]

	set_chr(114,673,	 7, 6,  -150,   0,  0,		  2,   180, 0,";")//リフト端[路線C]
	set_chr(115,673,	 7, 3,  -150, 250,  0,		  2,     0, 0,";")//リフト端[路線C]

	set_chr(116,653,	 8, 9,  -600,-1700, 0,		  2,   180, 0,";")//リフト用ロープa[路線A]
	set_chr(117,653,	 8, 8,  -600,-1700, 0,		  2,   180, 0,";")//リフト用ロープa[路線A]
	set_chr(118,653,	 8, 7,  -600, -900, 0,		  2,   180, 0,";")//リフト用ロープa[路線A]

	set_chr(119,653,	 7, 8,   150,-1950, 0,		  2,   180, 0,";")//リフト用ロープb[路線B]
	set_chr(120,653,	 7, 7,   150,-1950, 0,		  2,   180, 0,";")//リフト用ロープb[路線B]
	set_chr(121,653,	 7, 6,   150, -600, 0,		  2,   180, 0,";")//リフト用ロープb[路線B]

	set_chr(122,653,	 7, 6,  -150,-1050, 0,		  2,   180, 0,";")//リフト用ロープc[路線C]
	set_chr(123,653,	 7, 5,  -150,-1050, 0,		  2,   180, 0,";")//リフト用ロープc[路線C]
	set_chr(124,653,	 7, 4,  -150, -500, 0,		  2,   180, 0,";")//リフト用ロープc[路線C]

	set_chr(126,627,	 4, 1,  -900,    0, 0,		  0,    90, 0,";")	//柵小
	set_chr(127,627,	 4, 2,  -900,    0, 0,		  0,    90, 0,";")	//柵小
	set_chr(128,627,	 4, 3,     0, -350, 0,		  0,     0, 0,";")	//柵小
		color2(126, 41,81,100, 0,0,0)
		color2(127, 41,81,100, 0,0,0)
		color2(128, 41,81,100, 0,0,0)

	set_chr(130,661,	 8, 9,  -600, -950, 0,		  2,   180, 8,"M3_99 (SF107 Y2_4300 RF107 M4_99 WT?15 SF107 Y2_-4300 RF107 M3_99 WT?15);"); //⑦リフト台[路線A]
	if ( !F2190 )
	{
		set_chr(131,810,	 8, 9,  -600, -950,50,		  2,     0, 8,"(Y2_4300 WT?15 Y2_-4300 WT?15);"); //⑧大砲[路線A]
		set_chr(181,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F131 I_$$$2 SF2190;");
		chr_equip_chr(181,131,"obx0574:Layer1(1)",  100, 0,0,0,	0,0,45);
	}

	set_chr(132,661,	 7, 8,   150,-1200, 0,		  2,   180, 8,"M3_99 (SF108 Y2_3750 RF108 M4_99 WT?15 SF108 Y2_-3750 RF108 M3_99 WT?15);"); //⑩リフト台[路線B]

	set_chr(134,661,	 7, 6,  -150, -300, 0,		  2,   180, 8,"M3_99 (SF109 Y2_4550 RF109 M4_99 WT?15 SF109 Y2_-4550 RF109 M3_99 WT?15);"); //⑬リフト台[路線C]
	if ( !F2191 )
	{
		set_chr(135,810,	 7, 6,  -150, -300,50,		  2,     0, 8,"(Y2_4550 WT?15 Y2_-4550 WT?15);"); //⑭大砲[路線C]
		set_chr(185,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F135 I_$$$2 SF2191;");
		chr_equip_chr(185,135,"obx0574:Layer1(1)",  100, 0,0,0,	0,0,45);
	}

	if ( !F2185 )
	{
		// 爆発直後にボタンを押すとクロスフェードがうまくいかないのでウェイトを入れる
		if ( !F2106 )
		{
			set_chr( 65,642,	 4, 3,     0,  -50, 0,		  2,     0, 0,"#8_99 V4_55 M6_55 #3_55 WT?60 #5_55 SF2185;")	//⑮岩
			set_chr( 55,570,	 4, 3,     0, -50,  0,		 -1,     0, 5,"M6?99 M5_99 SF2106")	//①ボタンスイッチ
		}
		else
		{
			set_chr( 65,642,	 4, 3,     0,  -50, 0,		  2,     0, 0,"#8_99 V4_55 M7_55 #3_55 WT?60       SF2185;")	//⑮岩
			set_chr( 55,570,	 4, 3,     0, -50,  0,		 -1,     0, 3,";")	//①ボタンスイッチ
		}
	}
	else
	{
		// 爆発直後にボタンを押すとクロスフェードがうまくいかないのでウェイトを入れる
		if ( !F2106 )
		{
			set_chr( 55,570,	 4, 3,     0, -50,  0,		  6,     0, 5,"M6?99 M5_99 SF2106")	//①ボタンスイッチ
		}
		else
		{
			set_chr( 55,570,	 4, 3,     0, -50,  0,		  7,     0, 3,";")	//①ボタンスイッチ
		}
	}
	if ( !F2106 )
	{
		set_chr( 84,990,	 3, 2,     0,   0,  0,		  0,     0, 8,"F2106 O1_18 WT?10 C0_99 WT?10 SF103 WT?61 C0_0;");
	}
	else
	{
		F_set(103)
	}


	if ( !F2140 )
		set_chr( 47,630,	 8, 5,   350, 450,  0,		  2,    70, 0,"I_FD13 SF2140;")	//⑱樽
	else
		set_chr( 47,630,	 8, 5,   350, 450,  0,		  2,    70, 0,"I_$$$1;")	//⑱樽


	if ( !F2141 )
	{
		set_chr( 66,630,	 8, 5,   425, 225,  0,		  2,     0, 0,"#8_99 V1_59 M2_59 WT?35 #8_59 SF2141;")	//⑲樽
		set_chr( 59,804,	 8, 5,   425, 225,  0,		 -1,    90, 0,"(L2?99 [9991ピザは弁当とみなすべし] WT?30 L2!99 [9903] WT?30);")	//⑤看板
	}
	else
	{
		set_chr( 59,804,	 8, 5,   425, 225,  0,		  2,    90, 8,"(L2?99 [9991ピザは弁当とみなすべし] WT?30 L2!99 [9903] WT?30);")	//⑤看板
	}


	set_chr(150,808,	 4, 5,  1300,1800,  0,		  3,     0, 8,"WT?60 (X2_-450 X2_900 X2_-450);")	//⑳aトゲ球
	set_chr(151,808,	 4, 5,   -50,1250,  0,		  3,     0, 8,"WT?35 (Y2_-450 Y2_900 Y2_-450);")	//⑳bトゲ球
	set_chr(152,808,	 5, 5,    50, 450,  0,		  3,     0, 8,"WT?10 (Y2_-450 Y2_900 Y2_-450);")	//⑳cトゲ球

//■敵
	if ( !F2100 )
	{
		set_chr(  1,370,	 4, 5,   900, 900,  0,		 -1,     0, 8,"F101 V2_99 <EV_BossItemSpawner>;") //①敵 中ボス

		set_chr( 80,990,	 5, 5,   200,   0,  0,		  0,   107, 6,"SF100;")//①敵 中ボス部屋
		set_chr( 81,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F100 S0_1 WT?120 #6_82;")//警報出現
		set_chr( 82,990,	 4, 5,   900, 900,  0,		  0,072323,0,"SF101 M5_53;")//中ボス出現
		set_chr( 83,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F1 WT?10 O1_18 SF2100 <EV_NormalBGM> WT?30 C0_54 WT?20 M4_53 M4_54 WT?30 C0_0;")//中ボス戦闘終了判定

		// 中ボスBGM
		set_chr(160,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"(F110 <EV_BossBGM> WT?90 !F101 !F110 <EV_NormalBGM> WT?90);");
		set_chr(161,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F2100 F101 SF110");	// ボスが生きていて、ボス戦闘中ならば110をセット
		set_chr(162,990,	 4, 5,   900, 900,  0,		  0,072329, 6,"!F2100 F100 SF110");		// ボスが生きていて、警報がなっていて、ボス部屋内ならば110をセット
		set_chr(163,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"RF110");			// 110をクリア
	}
	else
	{
		MOT(54, 6, 1)
	}

	set_chr(  3,273,	 7, 8,   900, 900,400,		  2,   270, 0,";") //②敵 やまつつき

	set_chr(  4,274,	 8, 8,  -450, 150,  0,		  2,     0, 0,";") //③敵 ゆきおこじょ

	set_chr(  5,275,	 7, 7,     0, 900,  0,		  2,     0, 0,";") //④敵a ゆきやまがえる
	set_chr(  6,274,	 7, 7,     0, 900,  0,		  2,     0, 0,";") //④敵b ゆきおこじょ
		chr_equip_chr( 6, 5,"Bone_Spine1", 100,	0,  0,180,	0,0,25);

	set_chr(  9,274,	 7, 7,    50,-700,  0,		  2,     0, 0,";") //⑤敵 ゆきおこじょ

	set_chr( 10,128,	 7, 6,   600,   0,  0,		  2,     0, 0,";") //⑥敵a ちゃりおっと 標準Lv12 + 追加Lv0 = 12
		chr_state_LV(10, 1);
		chr_equip2(10,	"eq_161",	"Bone_Hips",	100,	 0,0,0,	0,0,-75);
	set_chr( 11,255,	 7, 6,   600,   0,  0,		  2,     0, 0,";") //⑥敵b もりこぼると	標準Lv8 + 追加Lv1 = 9
		chr_equip_chr( 11, 10,"Null_Mon", 100,	0,  0,180,	0,5, 0);
		chr_state_LV(11, 1);
	set_chr( 12,250,	 7, 6,   600, 000,  0,		  2,   180, 0,";") //⑥敵c こぼるてす	標準Lv5 + 追加Lv3 = 8
		chr_equip_chr( 12, 10,"Null_Mon", 100,	0,  0,180,	0,-75, 0);
		chr_state_LV(12, 3);
	set_chr(139,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F11 (!F10 M4_10 WT?15);") // ⑥敵 ちゃりおっと後始末

	set_chr( 18,273,	 7, 6,   250,-900,400,		  2,     0, 0,";") //⑦敵 やまつつき

	set_chr( 21,109,	 7, 4,   125, 850,  0,		  2,     0, 0,";") //⑧敵a りゅうだんいわ
	set_chr( 22,109,	 7, 4,  -450, 250,  0,		  2,     0, 0,";") //⑧敵b りゅうだんいわ

	set_chr( 23,111,	 6, 3,     0,-900,  0,		  2,    90, 0,";") //⑨敵a すざく
	set_chr( 24,111,	 6, 3,   900,   0,  0,		  2,   180, 0,";") //⑨敵b すざく

	set_chr( 25,275,	 6, 2,  -450,   0,  0,		  2,     0, 0,";") //⑩敵a ゆきやまがえる
	set_chr( 26,274,	 6, 2,  -450,   0,  0,		  2,     0, 0,";") //⑩敵b ゆきおこじょ
		chr_equip_chr( 26, 25,"Bone_Spine1", 100,	0,  0,180,	0,0,25);

//	set_chr( 27,275,	 8, 5,   -50,  50,  0,		  2,     0, 0,"D1_41;") //⑫敵 ゆきやまがえる
//	if ( !F2171 )
//	{
//		set_chr( 41,634,	 8, 5,   -50,  50, 50,		  0,   300, 0,"I_US01 SF2171;")	//②ハニワ
//		F_set_chr( 41, CF_NO_CSP)
//		chr_equip_chr(41, 27,"Bone_Spine1", 100,	0,  0,180,	0,0,35);
//	}

	if (!F2171)
	{
		set_chr( 27,275,	 8, 5,   -50,  50,  0,		  6,   300, 0,"D1_41 <EV_Show141>;")// <EV_RemoveHaniwa>;")	//⑫敵 ゆきやまがえる
		chr_equip2( 27,	"obx0104",	"Bone_Spine1", 100,	0,  0,180,	0,0,25);

		set_chr( 41,634,	 8, 5,   -50,  50,  0,		  6,   300, 0,"I_US01 SF2171;")	//③ハニワ
		chr_equip_chr( 41,27, "charbase0", 100,	0,0,0,		0, 0,0);
		F_set_chr( 41, CF_NO_CSP)

		set_chr(141,812,	 8, 5,   -50,  50,  0,		  0,   300, 0,";")
		chr_equip_chr(141,27, "charbase0", 100,	0,0,0,		0,0,0);
		color(141,-1);
	}
	else
	{
		set_chr( 27,275,	 8, 5,   -50,  50,  0,		  2,   300, 0,";")	//⑫敵 ゆきやまがえる
		set_chr(141,812,	 8, 5,   -50,  50,  0,		  0,   300, 0,";")
	}



//■イベント


	// リフトアニメ

	set_chr( 87,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"(F107 M3_110 M3_111 M3_116 M3_117 M3_118 !F107 M2_110 M2_111 M2_116 M2_117 M2_118);")//リフトアニメ[路線A]
	set_chr( 88,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"(F108 M3_112 M3_113 M3_119 M3_120 M3_121 !F108 M2_112 M2_113 M2_119 M2_120 M2_121);")//リフトアニメ[路線B]
	set_chr( 89,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"(F109 M3_114 M3_115 M3_122 M3_123 M3_124 !F109 M2_114 M2_115 M2_122 M2_123 M2_124);")//リフトアニメ[路線C]


//■場面固有設定

	EV("EV_SnowFall")
	EV("EV_OnsenMist")

}

//-------------------------------------------------------------------
EV_SnowFall
{
	EFF_chr(4292, 0, 0,100, -1, "charbase0" )
	wait( 50 )
	loop
}

//--------------------------------------------------------------------
EV_BossItemSpawner
{
	set_chr(164,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F1 I_FFF3 I_FFF3 I_FFF3;");
	chr_equip_chr(164, 1,"Bone_Body", 100,	0,0,0,	0,0,0);
}

//-------------------------------------------------------------------
EV_OnsenMist
{
	EFF( 6456,	 7850,-11100,100,  	0,100,0)
	EFF( 6456,	 9150,-11500,100,  	0,100,0)
	EFF( 6456,	 9550,-10300,100,  	0,100,0)

//	EFF(21045,	 7750,-10700,  0,  	0,100,0)
//	EFF(21045,	 8950,-11100,  0,  	0,100,0)
//	EFF(21045,	 9350, -9900,  0,  	0,100,0)

	wait( 10 )

	EFF(21045,	 7750,-10700,  0,  	0,100,0)
	EFF(21045,	 9050,-11100,  0,  	0,100,0)
	EFF(21045,	 9450, -9900,  0,  	0,100,0)

	EFF( 6456,	 7850,-11100,100,  	0,100,0)
	EFF( 6456,	 9150,-11500,100,  	0,100,0)
	EFF( 6456,	 9550,-10300,100,  	0,100,0)

	wait( 10 )
	loop
}

//--------------------------------------------------------------------
EV_SlotDarken
{
	wait(15)
	color2( 49, 70,70,70,,0,0,0)		// スロット暗く
}

//--------------------------------------------------------------------
EV_BossBGM
{
	stop_BGM(30)
	wait(30)
	BGM(35)
}

//--------------------------------------------------------------------
EV_NormalBGM
{
	stop_BGM(30)
	wait(30)
	BGM(30)
}

//--------------------------------------------------------------------
EV_Show141
{
	color(141,15);
	jump(141,3, 25,-1,-1, 15, 75)
}


#EndScriptTable
//====================================================================

